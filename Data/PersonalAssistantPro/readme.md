# PersonalAssistantPro (ä¸ªäººåŠ©æ‰‹ Pro)

> **åŸºäº OpenHarmony 6.0 (API 20) çš„ä¼ä¸šçº§ç»¼åˆäº‹åŠ¡ç®¡ç†è§£å†³æ–¹æ¡ˆ**

## ğŸ“– é¡¹ç›®ç®€ä»‹ (Introduction)

**PersonalAssistantPro** å¹¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„åŠŸèƒ½æ¼”ç¤º Demoï¼Œè€Œæ˜¯ä¸€ä¸ªä¸¥æ ¼éµå¾ª **ArkTS ä¸¥æ ¼æ¨¡å¼ (Strict Mode)** å¼€å‘çš„**ä¼ä¸šçº§åº”ç”¨æ¶æ„å‚è€ƒæ¨¡æ¿**ã€‚

æœ¬é¡¹ç›®åŸºäº **OpenHarmony API 20** æ„å»ºï¼Œæ—¨åœ¨è§£å†³å¼€å‘è€…åœ¨æ„å»ºä¸­å¤§å‹åº”ç”¨æ—¶é¢ä¸´çš„å·¥ç¨‹åŒ–ç—›ç‚¹ã€‚ä¸åŒäºç®€å•çš„â€œHello Worldâ€ï¼Œæœ¬é¡¹ç›®æä¾›äº†ä¸€å¥—å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæ¶µç›–äº†ä»**åŸºç¡€è®¾æ–½å»ºè®¾**ï¼ˆæ—¥å¿—ã€è°ƒè¯•ï¼‰åˆ°**æ ¸å¿ƒä¸šåŠ¡å®ç°**ï¼ˆåŠ å¯†ã€æŒä¹…åŒ–ã€åå°æœåŠ¡ï¼‰çš„å…¨é“¾è·¯å®è·µã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**

* **æ¶æ„è§„èŒƒ**: é‡‡ç”¨æ ‡å‡† MVVM + Service åˆ†å±‚æ¶æ„ï¼Œå®ç°é«˜å†…èšä½è€¦åˆã€‚
* **å·¥ç¨‹å®Œå¤‡**: å†…ç½®è‡ªä¸»ç ”å‘çš„**æ™ºèƒ½æ—¥å¿—ç³»ç»Ÿ**ä¸**çœŸæœºè°ƒè¯•æ¡†æ¶**ï¼Œå¤§å¹…æå‡å¼€å‘ä¸æ’é”™æ•ˆç‡ã€‚
* **æŠ€æœ¯æ·±åº¦**: æ·±å…¥å®è·µ RDB äº‹åŠ¡ã€UserIAM ç”Ÿç‰©è®¤è¯ã€AES-256 éšç§åŠ å¯†åŠåå°ä»£ç†æé†’ç­‰é«˜é˜¶èƒ½åŠ›ã€‚

---


## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„ (System Architecture)

æœ¬é¡¹ç›®é‡‡ç”¨ç»å…¸çš„ **MVVM (Model-View-ViewModel)** åˆ†å±‚æ¶æ„ï¼Œç»“åˆ **SOA (Service-Oriented Architecture)** æœåŠ¡åŒ–è®¾è®¡æ€æƒ³ï¼Œç¡®ä¿ UI ä¸ä¸šåŠ¡é€»è¾‘çš„å½»åº•è§£è€¦ã€‚

### 1. æ¶æ„å…¨æ™¯å›¾

![æ¶æ„.png](tu/%E6%9E%B6%E6%9E%84.png)

### 2. åˆ†å±‚è®¾è®¡è§„èŒƒ

* **UI Layer (Pages/View)**:
* **èŒè´£**: ä»…è´Ÿè´£ UI æ¸²æŸ“ä¸ç”¨æˆ·äº¤äº’äº‹ä»¶æ•è·ã€‚
* **è§„èŒƒ**: `MainPage` ä½œä¸ºå”¯ä¸€æ ¹å®¹å™¨ç®¡ç†è·¯ç”±æ ˆ (`NavPathStack`)ï¼Œä¸åŒ…å«å…·ä½“ä¸šåŠ¡é€»è¾‘ã€‚


* **ViewModel Layer**:
* **èŒè´£**: å……å½“ View ä¸ Model çš„é€‚é…å™¨ï¼Œç»´æŠ¤ UI çŠ¶æ€ï¼ˆä½¿ç”¨ `@Observed`/`@ObjectLink`ï¼‰ã€‚
* **è§„èŒƒ**: ç¦æ­¢ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œå¿…é¡»é€šè¿‡ Service å±‚è·å–æ•°æ®ã€‚


* **Service Layer**:
* **èŒè´£**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„èšé›†åœ°ï¼Œå®ç°è·¨é¡µé¢é€»è¾‘å¤ç”¨ï¼ˆå¦‚ï¼šæ•°æ®å¯¼å‡ºã€é€šçŸ¥åˆ†å‘ï¼‰ã€‚
* **è§„èŒƒ**: æœåŠ¡ç±»é€šå¸¸è®¾è®¡ä¸ºå•ä¾‹æˆ–é™æ€å·¥å…·ç±»ï¼Œä¿æŒæ— çŠ¶æ€æˆ–å…¨å±€å”¯ä¸€çŠ¶æ€ã€‚


* **Model Layer**:
* **èŒè´£**: è´Ÿè´£æ•°æ®çš„æŒä¹…åŒ–ã€åŠ å¯†/è§£å¯†åŠå®ä½“å®šä¹‰ã€‚
* **è§„èŒƒ**: æ‰€æœ‰æ•°æ®åº“æ“ä½œé€šè¿‡ `RdbHelper` ç»Ÿä¸€ä»£ç†ï¼Œç¡®ä¿äº‹åŠ¡å®‰å…¨ã€‚

## ğŸ§© æ ¸å¿ƒç‰¹æ€§ (Core Features)

æœ¬é¡¹ç›®èšç„¦äºå•†åŠ¡åŠå…¬åœºæ™¯ï¼Œå®ç°äº†ä»¥ä¸‹å››å¤§æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼š

### 1. ğŸ“… æ™ºèƒ½æ—¥ç¨‹ç®¡ç†

* **è‡ªå®šä¹‰è§†å›¾**: æŠ›å¼ƒåŸç”Ÿç®€å•çš„æ—¥å†æ§ä»¶ï¼Œè‡ªä¸»å°è£…é«˜æ€§èƒ½çš„ `MonthView` (æœˆè§†å›¾) ä¸ `WeekView` (å‘¨è§†å›¾)ï¼Œæ”¯æŒæ‰‹åŠ¿æ»‘åŠ¨åˆ‡æ¢ã€‚
* **å¤æ‚æŸ¥è¯¢**: æ”¯æŒæŒ‰æ—¥æœŸèŒƒå›´ (`queryRange`) ç­›é€‰ï¼ŒåŒæ—¶é›†æˆ `Search` ç»„ä»¶ï¼Œå®ç°äº†å¯¹æ ‡é¢˜ã€å¤‡æ³¨çš„å¤šå­—æ®µ**æ¨¡ç³Šæœç´¢**ã€‚

### 2. ğŸ” éšç§é€šè®¯å½•

* **å®‰å…¨å­˜å‚¨**: è”ç³»äººå§“åã€å…³ç³»ç­‰å­—æ®µæ˜æ–‡å­˜å‚¨ï¼Œä½†**æ‰‹æœºå· (Phone)** ç­‰æ•æ„Ÿå­—æ®µåœ¨è½åº“å‰è‡ªåŠ¨åŠ å¯†ã€‚
* **æƒé™ç®¡æ§**: åˆ—è¡¨é¡µä»…å±•ç¤ºè„±æ•æ•°æ®ï¼ˆå¦‚ `138****0000`ï¼‰ï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…æ—¶è§¦å‘**ç”Ÿç‰©è®¤è¯**ï¼Œåªæœ‰è®¤è¯é€šè¿‡æ‰è§£å¯†å±•ç¤ºå®Œæ•´å·ç ã€‚

### 3. ğŸ”” åå°ä»£ç†æé†’

* **å‡†æ—¶è§¦è¾¾**: åŸºäºç³»ç»Ÿçº§ `ReminderAgent` æœºåˆ¶ï¼Œå³ä½¿åº”ç”¨è¢«æ¸…ç†å‡ºåå°ï¼Œä»èƒ½å‡†æ—¶å”¤èµ·ç³»ç»Ÿé€šçŸ¥ã€‚
* **äº¤äº’é—­ç¯**: é€šçŸ¥æ æ”¯æŒâ€œå…³é—­â€æˆ–â€œå»¶å 10 åˆ†é’Ÿâ€æ“ä½œï¼Œä¸”æ“ä½œç»“æœä¼šè‡ªåŠ¨åŒæ­¥å›åº”ç”¨å†…çš„æ—¥ç¨‹çŠ¶æ€ã€‚

### 4. ğŸ“¦ æ•°æ®ä¸­å°

* **å¤šæ ¼å¼å¯¼å‡º**: æ”¯æŒå°†æœ¬åœ°æ•°æ®åº“å…¨é‡å¯¼å‡ºä¸º **HTML ç»Ÿè®¡æŠ¥è¡¨** (å†…è” CSS æ ·å¼) æˆ– **XML å¤‡ä»½æ–‡ä»¶**ã€‚
* **æ–‡ä»¶æ²™ç®±**: æ¼”ç¤ºäº†æ ‡å‡†çš„æ–‡ä»¶ IO æ“ä½œä¸åº”ç”¨æ²™ç®± (`/data/storage/el2/base/files`) ç®¡ç†ã€‚

---

## ğŸ› ï¸ å…³é”®æŠ€æœ¯å®ç° (Technical Highlights)

æœ¬é¡¹ç›®æ·±å…¥å®è·µäº† OpenHarmony API 20 çš„å¤šé¡¹é«˜é˜¶èƒ½åŠ›ï¼Œä»¥ä¸‹æ˜¯æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆçš„è¯¦ç»†è§£æã€‚

### 1. ğŸ’¾ é«˜çº§æ•°æ®æŒä¹…åŒ– (RDB)

> **ä»£ç è·¯å¾„**: `entry/src/main/ets/common/database/RdbHelper.ts`

æˆ‘ä»¬å°è£…äº†ä¸€ä¸ªé€šç”¨çš„ `RdbHelper` ç±»ï¼Œè§£å†³äº†åŸç”Ÿ `relationalStore` API ä½¿ç”¨ç¹ççš„é—®é¢˜ï¼š

* **äº‹åŠ¡ç®¡ç†**: æ‰€æœ‰å†™æ“ä½œï¼ˆInsert/Update/Deleteï¼‰å‡åŒ…è£¹åœ¨ Transaction ä¸­ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚
* **åŠ¨æ€æŸ¥è¯¢**: å®ç°äº† SQL `LIKE` è¯­æ³•çš„åŠ¨æ€æ‹¼æ¥ï¼Œæ”¯æŒ `Search` ç»„ä»¶å¯¹æ•°æ®åº“çš„å¤šå­—æ®µæ¨¡ç³ŠåŒ¹é…ã€‚
* **ç±»å‹å®‰å…¨**: ä¸¥æ ¼éµå¾ª ArkTS ç±»å‹è§„èŒƒï¼Œå¯¹ Entity ä¸ RDB å­—æ®µè¿›è¡Œäº†å®Œæ•´çš„æ˜ å°„å¤„ç†ã€‚

### 2. ğŸ›¡ï¸ éšç§å®‰å…¨ä½“ç³» (Crypto + UserIAM)

> **ä»£ç è·¯å¾„**: `entry/src/main/ets/common/utils/AesCryptoUtils.ts`

ä¸ºæ»¡è¶³ä¼ä¸šçº§å®‰å…¨è¦æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€å¥—å®Œæ•´çš„éšç§ä¿æŠ¤æµç¨‹ï¼š

* **AES-256 åŠ å¯†æµç¨‹**:
1. **å¯†é’¥ç”Ÿæˆ**: ä½¿ç”¨ `cryptoFramework.createSymKeyGenerator('AES256')` ç”Ÿæˆå¯¹ç§°å¯†é’¥ã€‚
2. **åŠ å¯† (Encrypt)**: `TextEncoder` è½¬ç  -> ç”Ÿæˆéšæœº 16ä½ IV -> `Cipher` åŠ å¯† -> æ‹¼æ¥ IV ä¸å¯†æ–‡ -> Base64 ç¼–ç ã€‚
3. **è½åº“**: å°† Base64 å­—ç¬¦ä¸²å­˜å…¥ RDBã€‚


* **ç”Ÿç‰©è®¤è¯æµç¨‹**:
* è°ƒç”¨ `userAuth.getAvailableStatus()` æ£€æŸ¥è®¾å¤‡æ˜¯å¦å…·å¤‡è®¤è¯èƒ½åŠ›ï¼ˆæŒ‡çº¹/äººè„¸ï¼‰ã€‚
* æ‹‰èµ·ç³»ç»Ÿç»Ÿä¸€è®¤è¯å¼¹çª— (`AuthWidgetMgr`)ï¼Œç”¨æˆ·éªŒè¯é€šè¿‡åï¼Œæ‰æ‰§è¡Œ `AesCryptoUtils.decrypt()` è§£å¯†é€»è¾‘ã€‚


### 3. ğŸ—ï¸ ç»Ÿä¸€è·³è½¬æœåŠ¡ (JumpService)

> **ä»£ç è·¯å¾„**: `entry/src/main/ets/services/JumpService.ts`

ä¸ºäº†è§£è€¦ UI å±‚ä¸ç³»ç»Ÿèƒ½åŠ›ï¼Œæˆ‘ä»¬å®ç°äº† `JumpService` å•ä¾‹ï¼š

* **å¤–éƒ¨åº”ç”¨æ‹‰èµ·**: æ„å»ºåŒ…å« `entities: ['entity.system.browsable']` çš„ `Want`ï¼Œé€šè¿‡ `context.startAbility` æ‹‰èµ·ç³»ç»Ÿæµè§ˆå™¨æ‰“å¼€ URLã€‚
* **ç³»ç»Ÿè®¾ç½®è·³è½¬**: å®šå‘æ‹‰èµ· `com.huawei.hmos.settings`ï¼Œå¼•å¯¼ç”¨æˆ·å¼€å¯é€šçŸ¥æˆ–ç”Ÿç‰©è®¤è¯æƒé™ã€‚
* **DeepLink è§£æ**: é¢„ç•™äº† `pa://` åè®®çš„è§£æé€»è¾‘ï¼Œä¸ºè·¨åº”ç”¨è°ƒç”¨æä¾›æ¥å£ã€‚
  å¥½çš„ï¼Œè¿™æ˜¯ **ç¬¬ä¸‰é˜¶æ®µ** çš„å†…å®¹ï¼ŒåŒ…å« **å·¥ç¨‹åŒ–ä¸åŸºç¡€è®¾æ–½** ä»¥åŠ **ç›®å½•ç»“æ„**ã€‚


## âš™ï¸ å·¥ç¨‹åŒ–ä¸åŸºç¡€è®¾æ–½ (Infrastructure)

ä¸ºäº†è§£å†³å¤§å‹é¡¹ç›®ä¸­â€œæ—¥å¿—å™ªç‚¹å¤šâ€å’Œâ€œä¸šåŠ¡é€»è¾‘éš¾ä»¥è„±ç¦» UI è°ƒè¯•â€çš„ç—›ç‚¹ï¼Œæœ¬é¡¹ç›®å†…ç½®äº†ä¸¤å¥—è‡ªä¸»ç ”å‘çš„åŸºç¡€è®¾æ–½ã€‚

### 1. ğŸ“ æ™ºèƒ½æ—¥å¿—ç³»ç»Ÿ (Smart Logger)

> **ä»£ç è·¯å¾„**: `entry/src/main/ets/common/utils/Logger.ts`

æ‘’å¼ƒåŸç”Ÿçš„ `console.log`ï¼Œå°è£…äº†åŸºäº `hilog` çš„ `Logger` ç±»ï¼Œå®ç°äº†**æ¨¡å—åŒ–ç®¡ç†**ä¸**åŠ¨æ€å™ªå£°è¿‡æ»¤**ã€‚

* **è‡ªåŠ¨ Tag**: æ‰€æœ‰æ—¥å¿—è‡ªåŠ¨æºå¸¦ `PA_Pro_{ModuleName}` å‰ç¼€ï¼Œä¾¿äºåœ¨ Log é¢æ¿æ­£åˆ™ç­›é€‰ã€‚
* **é»‘/ç™½åå•æ¨¡å¼**: æ”¯æŒåœ¨ `Logger.ts` ä¸­é…ç½® `FILTER_MODE`ï¼š
* `BLOCK_LIST` (é»‘åå•): é»˜è®¤æ‰“å°æ‰€æœ‰ï¼Œå±è”½åˆ—è¡¨ä¸­çš„æ¨¡å—ï¼ˆé€‚åˆå¼€å‘åˆæœŸï¼‰ã€‚
* `ALLOW_LIST` (ç™½åå•): é»˜è®¤ä¸æ‰“å°ï¼Œä»…å…³æ³¨åˆ—è¡¨ä¸­çš„æ¨¡å—ï¼ˆé€‚åˆä¸“æ³¨è°ƒè¯•ï¼‰ã€‚


* **æ™ºèƒ½æ ¼å¼åŒ–**: ç›´æ¥ä¼ å…¥ Object/JSONï¼Œè‡ªåŠ¨åºåˆ—åŒ–è¾“å‡ºï¼Œæ— éœ€æ‰‹åŠ¨ `JSON.stringify`ã€‚

### 2. ğŸ§ª çœŸæœºé›†æˆæµ‹è¯•æ¡†æ¶ (Debug Runner)

> **ä»£ç è·¯å¾„**: `entry/src/main/ets/debug/`

ç”±äº OpenHarmony åº”ç”¨æ¶‰åŠå¤§é‡åŸç”Ÿèƒ½åŠ›ï¼ˆRDBã€UserIAMï¼‰ï¼Œçº¯å•å…ƒæµ‹è¯•éš¾ä»¥è¦†ç›–çœŸå®ç¯å¢ƒã€‚æˆ‘ä»¬è®¾è®¡äº†ä¸€å¥— **DebugRunner**ï¼Œå…è®¸åœ¨çœŸæœºä¸Šç›´æ¥è¿è¡Œåç«¯é€»è¾‘æµ‹è¯•ç”¨ä¾‹ã€‚

#### å¦‚ä½•æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹ (3æ­¥èµ°)ï¼š

1. **æ–°å»º Case**: åœ¨ `debug/` ç›®å½•ä¸‹æ–°å»ºç±»ç»§æ‰¿ `DebugCase`ã€‚
```typescript
export class MyNewTest extends DebugCase {
  readonly name = 'My Feature Test';
  async run(): Promise<void> {
    this.logInfo('Start...');
    // ç›´æ¥è°ƒç”¨ Service/Model å±‚é€»è¾‘ï¼Œæ”¯æŒ await
    const result = await MyService.doSomething();
    this.logInfo('Result:', result);
  }
}

```


2. **æ³¨å†Œ**: åœ¨ `DebugRunner.ts` çš„å·¥å‚æ–¹æ³•ä¸­è¿”å›è¯¥å®ä¾‹ã€‚
3. **è¿è¡Œ**: è¿›å…¥ App **"æˆ‘çš„" -> "è°ƒè¯•å…¥å£"**ï¼Œå³å¯è§¦å‘è¿è¡Œå¹¶åœ¨ Log æ§åˆ¶å°æŸ¥çœ‹ç»“æœã€‚

---

## ğŸ“‚ ç›®å½•ç»“æ„ (Project Structure)

æœ¬é¡¹ç›®ç»“æ„æ¸…æ™°ï¼Œéµå¾ª **Feature-First** ä¸ **Layer-First** æ··åˆçš„ç»„ç»‡æ–¹å¼ï¼š

```text
entry/src/main/ets
â”œâ”€â”€ common                  # [å…¬å…±åŸºç¡€å±‚]
â”‚   â”œâ”€â”€ constants           # å…¨å±€å¸¸é‡ (StyleConstants, CommonConstants)
â”‚   â”œâ”€â”€ database            # æ•°æ®åº“æ ¸å¿ƒ (RdbHelper, Table Definitions)
â”‚   â””â”€â”€ utils               # æ ¸å¿ƒå·¥å…·é“¾ (AesCrypto, Logger, DateUtils, Validation)
â”œâ”€â”€ debug                   # [æµ‹è¯•åŸºç¡€è®¾æ–½]
â”‚   â”œâ”€â”€ DebugRunner.ets     # æµ‹è¯•è¿è¡Œå™¨æ ¸å¿ƒ
â”‚   â””â”€â”€ *Case.ts            # å„ç±»è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ (Crypto, RDB, Performance)
â”œâ”€â”€ entryability            # [åº”ç”¨å…¥å£] Ability ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”œâ”€â”€ model                   # [æ•°æ®æ¨¡å‹å±‚] (Entity + DAO)
â”‚   â”œâ”€â”€ ContactModel.ts     # è”ç³»äººæ•°æ®æ“ä½œ
â”‚   â”œâ”€â”€ EventModel.ets      # æ—¥ç¨‹æ•°æ®æ“ä½œ
â”‚   â””â”€â”€ SettingModel.ets    # è®¾ç½®é¡¹æ•°æ®æ“ä½œ
â”œâ”€â”€ pages                   # [è·¯ç”±å®¹å™¨å±‚]
â”‚   â”œâ”€â”€ MainPage.ets        # å…¨å±€å”¯ä¸€æ ¹å®¹å™¨ (Navigation)
â”‚   â”œâ”€â”€ SplashPage.ets      # å¯åŠ¨é¡µ
â”‚   â””â”€â”€ [BusinessPages]     # ä¸šåŠ¡é¡µé¢ (Mine, Detail, Edit...)
â”œâ”€â”€ services                # [ä¸šåŠ¡æœåŠ¡å±‚] (è§£è€¦æ ¸å¿ƒé€»è¾‘)
â”‚   â”œâ”€â”€ BiometricService    # ç”Ÿç‰©è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ DataExportService   # æ•°æ®å¯¼å‡º/æŠ¥è¡¨ç”ŸæˆæœåŠ¡
â”‚   â”œâ”€â”€ JumpService         # è·¯ç”±è·³è½¬ä¸ DeepLink æœåŠ¡
â”‚   â””â”€â”€ NotificationService # åå°é€šçŸ¥æœåŠ¡
â”œâ”€â”€ view                    # [UI ç»„ä»¶åº“]
â”‚   â”œâ”€â”€ calendar            # è‡ªç ”æ—¥å†ç»„ä»¶ (MonthView, WeekView)
â”‚   â”œâ”€â”€ component           # é€šç”¨ç»„ä»¶ (TitleBar, Dialog)
â”‚   â””â”€â”€ form                # è¡¨å•ç»„ä»¶ (DatePicker, TextInput)
â””â”€â”€ viewmodel               # [è§†å›¾æ¨¡å‹å±‚] å¤„ç† UI çŠ¶æ€æµè½¬

```