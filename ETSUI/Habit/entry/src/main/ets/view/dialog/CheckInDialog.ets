/**
 * æ‰“å¡å¿ƒå¾—è¾“å…¥å¼¹çª—
 */
@CustomDialog
export struct CheckInDialog {
  controller: CustomDialogController;
  // ç¡®è®¤å›žè°ƒï¼šå°†é€‰æ‹©çš„å¿ƒæƒ…å’Œè¾“å…¥çš„å¿ƒå¾—ä¼ å›žçˆ¶ç»„ä»¶
  onConfirm: (mood: number, note: string) => void = () => {};

  @State selectedMood: number = 1; // é»˜è®¤å¿ƒæƒ…ç´¢å¼•
  @State note: string = '';

  // å¿ƒæƒ…é€‰é¡¹é…ç½®
  moods: string[] = ['ðŸ˜', 'ðŸ™‚', 'ðŸ˜„', 'ðŸ¤©'];
  moodLabels: string[] = ['å¹³æ·¡', 'å¼€å¿ƒ', 'è¶…æ£’', 'ç‹‚å–œ'];

  build() {
    Column() {
      Text('âœ¨ æ‰“å¡æˆåŠŸ')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 20, bottom: 10 })

      Text('è®°å½•ä¸€ä¸‹æ­¤åˆ»çš„å¿ƒæƒ…å§~')
        .fontSize(14)
        .fontColor('#999')
        .margin({ bottom: 20 })

      // 1. å¿ƒæƒ…é€‰æ‹©åŒºåŸŸ
      Row({ space: 15 }) {
        ForEach(this.moods, (emoji: string, index: number) => {
          Column() {
            Text(emoji).fontSize(30)
            Text(this.moodLabels[index]).fontSize(10).fontColor('#666').margin({ top: 4 })
          }
          .padding(10)
          // é€‰ä¸­é«˜äº®é€»è¾‘
          .backgroundColor(this.selectedMood === index ? '#E6F2FF' : '#F5F5F5')
          .borderRadius(12)
          .border({ width: 2, color: this.selectedMood === index ? '#007DFF' : 'transparent' })
          .onClick(() => {
            this.selectedMood = index;
          })
        })
      }
      .margin({ bottom: 20 })

      // 2. å¿ƒå¾—è¾“å…¥æ¡†
      TextArea({ placeholder: 'å†™ç‚¹ä»€ä¹ˆ...(é€‰å¡«)', text: this.note })
        .height(100)
        .backgroundColor('#F5F5F5')
        .borderRadius(12)
        .onChange((value) => {
          this.note = value;
        })
        .margin({ bottom: 20 })

      // 3. åº•éƒ¨æŒ‰é’®
      Row() {
        Button('è·³è¿‡')
          .backgroundColor('#F5F5F5')
          .fontColor('#666')
          .layoutWeight(1)
          .margin({ right: 10 })
          .onClick(() => {
            // è·³è¿‡ä¹Ÿç®—æ‰“å¡ï¼Œä¼ é»˜è®¤å¿ƒæƒ…å’Œç©ºæ–‡å­—
            this.onConfirm(1, '');
            this.controller.close();
          })

        Button('ç¡®å®š')
          .backgroundColor('#007DFF')
          .fontColor(Color.White)
          .layoutWeight(1)
          .onClick(() => {
            this.onConfirm(this.selectedMood, this.note);
            this.controller.close();
          })
      }
      .width('100%')
    }
    .padding(20)
    .backgroundColor(Color.White)
    .borderRadius(24)
    .width('90%')
  }
}