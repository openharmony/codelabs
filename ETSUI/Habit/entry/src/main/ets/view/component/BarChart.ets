/*
 * Copyright (c) 2026 Huawei Device Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
@Component
export struct BarChart {
  @Prop data: number[];
  @Prop labels: string[];

  build() {
    Column() {
      Text("è¿‘ 7 å¤©è¶‹åŠ¿")
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .width('100%')
        .margin({ bottom: 20 })

      // å›¾è¡¨ä¸»ä½“åŒºåŸŸ
      Row({ space: 10 }) {
        // æ‰¾å‡ºæœ€å¤§å€¼ï¼Œç¡®ä¿æ¯”ä¾‹æ­£ç¡®
        ForEach(this.data, (count: number, index: number) => {
          this.BarItem(count, this.labels[index], this.getMaxValue())
        })
      }
      .width('100%')
      // ğŸ”´ åˆ é™¤å›ºå®šçš„ .height(150)ï¼Œè®©å†…å®¹è‡ªå·±æ’‘å¼€
      .alignItems(VerticalAlign.Bottom)
      .justifyContent(FlexAlign.SpaceBetween)
    }
    .padding(15)
    .backgroundColor(Color.White)
    .borderRadius(16)
    .width('100%')
  }

  getMaxValue(): number {
    let max = 0;
    this.data.forEach(v => {
      if (v > max) {
        max = v;
      }
    });
    return max < 5 ? 5 : max;
  }

  @Builder
  BarItem(count: number, label: string, max: number) {
    Column() {
      // 1. æŸ±å­å®¹å™¨ (å›ºå®šé«˜åº¦å®‰å…¨åŒº)
      // æŸ±å­æœ€é«˜åªèƒ½åœ¨è¿™ä¸ª 100vp çš„ç›’å­é‡Œç”Ÿé•¿ï¼Œç»å¯¹ä¸ä¼šæŒ¤åˆ°ä¸‹é¢çš„å­—
      Column() {
        Column()
          .width(12)
          // è®¡ç®—é«˜åº¦ç™¾åˆ†æ¯”
          .height(`${(count / max) * 100}%`)
          .backgroundColor(count > 0 ? '#007DFF' : '#F0F0F0')
          .borderRadius({ topLeft: 4, topRight: 4 })
          .animation({ duration: 500 })
      }
      .height(100) // ğŸ‘ˆ å…³é”®ä¿®å¤ï¼šç»™æŸ±å­åˆ’å®šé«˜åº¦ä¸Šé™
      .width('100%')
      .justifyContent(FlexAlign.End) // è®©æŸ±å­æ²‰åº•å¯¹é½
      .alignItems(HorizontalAlign.Center)

      // 2. æ•°å€¼ (æ”¾åœ¨æŸ±å­ä¸Šé¢ä¸€ç‚¹ç‚¹ï¼Œæˆ–è€…è¿™é‡Œç®€å•å¤„ç†æ”¾åœ¨ä¸‹é¢)
      // ä¸ºäº†å¸ƒå±€æ•´é½ï¼Œæˆ‘ä»¬æŠŠæ•°å€¼æš‚æ—¶éšè—ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥æ”¾å‡ºæ¥
      // Text(count.toString()).fontSize(10)...

      // 3. æ—¥æœŸæ ‡ç­¾ (å®‰å…¨åœ°å¾…åœ¨ä¸‹é¢)
      Text(label)
        .fontSize(10)
        .fontColor('#666')
        .margin({ top: 8 }) // ğŸ‘ˆ å¢åŠ ä¸€ç‚¹é—´è·ï¼Œæ›´ç¾è§‚
        .maxLines(1) // é˜²æ­¢æ¢è¡Œ
        .textOverflow({ overflow: TextOverflow.Ellipsis })
    }
    // è®©æ¯åˆ—å¹³åˆ†å®½åº¦ï¼Œé˜²æ­¢æŒ¤åœ¨ä¸€èµ·
    .layoutWeight(1)
  }
}