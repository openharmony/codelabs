/*
 * Copyright (c) 2026 Huawei Device Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import router from '@ohos.router';
import PreferenceUtil from '../utils/PreferenceUtil';
import common from '@ohos.app.ability.common';

@Entry
@Component
struct SettingsPage {
  private appVersion: string = 'v1.0.2';
  private buildVersion: string = '20231105_Beta';
  private developerEmail: string = 'support@mypassword.app';

  handleLogout(): void {
    try {
      AlertDialog.show({
        title: 'é€€å‡ºç™»å½•',
        message: 'é€€å‡ºåŽï¼Œä¸‹æ¬¡è¿›å…¥åº”ç”¨éœ€è¦é‡æ–°éªŒè¯èº«ä»½ã€‚',
        primaryButton: { value: 'å–æ¶ˆ', action: () => {} },
        secondaryButton: {
          value: 'é€€å‡º',
          fontColor: Color.Red,
          action: () => {
            let context = getContext(this) as common.UIAbilityContext;
            PreferenceUtil.init(context).then(async () => {
              await PreferenceUtil.clearLoginInfo();
              try {
                router.replaceUrl({ url: 'pages/LoginPage' });
              } catch (e) {
                console.error(`Nav error: ${JSON.stringify(e)}`);
              }
            });
          }
        }
      });
    } catch (e) {
      console.error(`Dialog error: ${JSON.stringify(e)}`);
    }
  }

  @Builder InfoRow(label: string, value: string) {
    Row() {
      Text(label).fontSize(16).fontColor(0x333333)
      Blank()
      Text(value).fontSize(16).fontColor(Color.Gray)
    }
    .width('100%')
    .padding({ top: 15, bottom: 15 })
    .border({ width: { bottom: 1 }, color: 0xF0F0F0 })
  }

  @Builder TextParagraph(title: string, content: string) {
    Column() {
      Text(title)
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .fontColor(0x333333)
        .width('100%')
        .margin({ bottom: 8 })

      Text(content)
        .fontSize(14)
        .fontColor(0x666666)
        .lineHeight(22)
        .width('100%')
    }
    .width('100%')
    .padding(15)
    .backgroundColor(Color.White)
    .borderRadius(8)
    .margin({ bottom: 10 })
  }

  build() {
    Column() {
      Row() {
        Text('< è¿”å›ž')
          .fontSize(16).fontColor(Color.Gray)
          .onClick(() => {
            try { router.back(); } catch (e) {}
          })
        Blank()
        Text('è®¾ç½®ä¸Žå…³äºŽ').fontSize(18).fontWeight(FontWeight.Bold)
        Blank()
        Text('      ')
      }
      .width('100%').padding(15).backgroundColor(Color.White)

      Scroll() {
        Column() {
          // å¤´éƒ¨
          Column() {
            // ã€ä¿®å¤ã€‘ç”¨ Emoji ä»£æ›¿ä¸å­˜åœ¨çš„å›¾ç‰‡èµ„æºï¼Œè§£å†³ Unknown resource æŠ¥é”™
            Text('ðŸ”')
              .fontSize(60)
              .margin({ bottom: 10 })
            Text('æˆ‘çš„å¯†ç æœ¬')
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .margin({ bottom: 5 })
            Text(`Version ${this.appVersion}`)
              .fontSize(14)
              .fontColor(Color.Gray)
          }
          .width('100%')
          .padding(30)
          .alignItems(HorizontalAlign.Center)

          // è¯¦ç»†ä¿¡æ¯
          Column() {
            this.InfoRow('æž„å»ºç‰ˆæœ¬', this.buildVersion)
            this.InfoRow('å¼€å‘è¯­è¨€', 'ArkTS / HarmonyOS')
            this.InfoRow('æ•°æ®å­˜å‚¨', 'RDB (æœ¬åœ°æ•°æ®åº“)')
            this.InfoRow('è”ç³»æˆ‘ä»¬', this.developerEmail)
          }
          .padding({ left: 15, right: 15 })
          .backgroundColor(Color.White)
          .borderRadius(12)
          .margin({ bottom: 20 })

          // å¸®åŠ©æ–‡æ¡£
          Text('ä½¿ç”¨æŒ‡å—')
            .fontSize(14).fontColor(Color.Gray).margin({ left: 5, bottom: 8 })

          this.TextParagraph(
            'å¦‚ä½•ä¿éšœæ•°æ®å®‰å…¨ï¼Ÿ',
            'æœ¬åº”ç”¨é‡‡ç”¨ç¦»çº¿ä¼˜å…ˆç­–ç•¥ï¼Œæ‚¨çš„æ‰€æœ‰è´¦å·å¯†ç ä»…å­˜å‚¨åœ¨å½“å‰æ‰‹æœºçš„æœ¬åœ°å®‰å…¨åŒºåŸŸï¼Œç»ä¸ä¼šä¸Šä¼ è‡³ä»»ä½•äº‘ç«¯æœåŠ¡å™¨ã€‚'
          )


          this.TextParagraph(
            'å…è´£å£°æ˜Ž',
            'æœ¬åº”ç”¨ä»…ä½œä¸ºå¯†ç è¾…åŠ©è®°å¿†å·¥å…·ï¼Œå¼€å‘è€…ä¸å¯¹å› ç”¨æˆ·æ‰‹æœºä¸¢å¤±ã€ä¸­ç—…æ¯’æˆ–Rootç ´è§£å¯¼è‡´çš„æ•°æ®æ³„éœ²æ‰¿æ‹…æ³•å¾‹è´£ä»»ã€‚'
          )

          // åº•éƒ¨æŒ‰é’®
          Button('é€€å‡ºç™»å½•')
            .width('100%')
            .height(50)
            .backgroundColor(0xFF5252)
            .fontColor(Color.White)
            .borderRadius(25)
            .margin({ top: 20, bottom: 40 })
            .onClick(() => this.handleLogout())

          Text('Copyright Â© 2023-2024 MySecurity Inc.')
            .fontSize(12)
            .fontColor(Color.Gray)
            .margin({ bottom: 20 })
        }
        .padding(15)
      }
      .layoutWeight(1)
      .align(Alignment.Top)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(0xF0F2F5)
  }
}