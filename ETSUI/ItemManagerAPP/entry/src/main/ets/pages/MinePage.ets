/*
 * Copyright (c) 2026 Huawei Device Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { promptAction } from '@kit.ArkUI';
import picker from '@ohos.file.picker'; // å›¾ç‰‡é€‰æ‹©å™¨
import { UserInfo, AppInfo } from '../model/types';
import { itemStore } from '../store';
import userInfoRdb from '../data/UserRdb';
import common from '@ohos.app.ability.common';

@Component
export struct MinePage {
  // é¡µé¢çŠ¶æ€
  @State showConfirmDialog: boolean = false;
  @State showNoDataDialog: boolean = false;
  @State showSuccessDialog: boolean = false;
  @State showHelpDialog: boolean = false;
  @State showEditDialog: boolean = false;
  @State showAvatarSelectDialog: boolean = false; // å¤´åƒé€‰æ‹©å¼¹çª—
  @State nicknameInput: string = ''; // ç§»é™¤é»˜è®¤å€¼ï¼Œä»æ•°æ®åº“åŠ è½½
  @State isClearing: boolean = false;
  @State itemCount: number = 0;
  @State isLoading: boolean = true;
  @State isUserInfoLoading: boolean = true; // æ–°å¢ï¼šç”¨æˆ·ä¿¡æ¯åŠ è½½çŠ¶æ€
  // é¢„è®¾å¤´åƒåº“ï¼ˆè¡¨æƒ…ï¼‰
  private avatarLibrary: string[] = [
    'ğŸ‘¤', 'ğŸ‘¨â€ğŸ’»', 'ğŸ‘©â€ğŸ’»', 'ğŸ§‘â€ğŸ’»', 'ğŸ±', 'ğŸ¶', 'ğŸ¦', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»'
  ];
  // ç”¨æˆ·ä¿¡æ¯ï¼ˆåˆå§‹åŒ–ä¸ºç©ºï¼Œä»æ•°æ®åº“åŠ è½½ï¼Œæ—  id å­—æ®µï¼‰
  @State userInfo: UserInfo = {
    avatar: '',
    nickname: '',
    joinDate: ''
  };
  // åº”ç”¨ä¿¡æ¯
  private appInfo: AppInfo = {
    name: 'è½»ç‰©å¿—',
    version: '1.0.0',
    description: 'æ™ºèƒ½ç‰©å“ç®¡ç†åŠ©æ‰‹',
    developer: 'OpenHarmonyè¯¾ç¨‹å°ç»„',
    copyright: 'Â© 2026 OpenHarmonyè¯¾ç¨‹å°ç»„'
  };

  // ========== é¡µé¢ç”Ÿå‘½å‘¨æœŸï¼ˆæ ¸å¿ƒé€‚é…ï¼šæ—  id é€»è¾‘ï¼‰ ==========
  async onCreate() {
    console.info('MinePage åˆ›å»ºï¼Œå¼€å§‹åˆå§‹åŒ–æ•°æ®');
    // å¹¶è¡ŒåŠ è½½ç‰©å“æ•°é‡å’Œç”¨æˆ·ä¿¡æ¯ï¼ˆæ—  id ç›¸å…³é€»è¾‘ï¼‰
    await Promise.all([
      this.initItemCount(),
      this.loadUserInfo()// åŠ è½½ç”¨æˆ·ä¿¡æ¯æ—¶æ— éœ€å¤„ç† id
    ]);
  }

  aboutToAppear(): void {
    console.info('æˆ‘çš„é¡µé¢æ˜¾ç¤º');
    itemStore.onItemCountChange(this.handleItemCountChange);

    // æ¯æ¬¡é¡µé¢æ˜¾ç¤ºæ—¶é‡æ–°åŠ è½½æœ€æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆæ—  idï¼‰
    this.loadUserInfo().catch((error: Error) => {
      console.error('é¡µé¢æ˜¾ç¤ºæ—¶åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error.message);
      this.isUserInfoLoading = false;
    });

    if (this.isLoading) {
      this.initItemCount().catch((error: Error) => {
        console.error('é¡µé¢æ˜¾ç¤ºæ—¶åŠ è½½æ•°æ®å¤±è´¥:', error.message);
        this.isLoading = false;
      });
    }
  }

  aboutToDisappear(): void {
    console.info('æˆ‘çš„é¡µé¢æ¶ˆå¤±');
    itemStore.offItemCountChange(this.handleItemCountChange);
  }

  // ========== æ ¸å¿ƒåˆå§‹åŒ–æ–¹æ³•ï¼ˆæ—  id é€»è¾‘ï¼‰ ==========
  private async initItemCount(): Promise<void> {
    try {
      console.info('å¼€å§‹ä»æ•°æ®åº“åˆå§‹åŒ–ç‰©å“æ•°é‡');
      const count = await itemStore.getItemCount();
      this.itemCount = count;
      console.info(`åˆå§‹åŒ–ç‰©å“æ•°é‡æˆåŠŸ: ${count}ä¸ª`);
    } catch (error) {
      console.error('åˆå§‹åŒ–ç‰©å“æ•°é‡å¤±è´¥:', error.message);
      this.itemCount = 0;
      this.showErrorToast('åŠ è½½ç‰©å“æ•°é‡å¤±è´¥');
    } finally {
      this.isLoading = false;
    }
  }

  // æ ¸å¿ƒé€‚é…ï¼šåŠ è½½ç”¨æˆ·ä¿¡æ¯æ—¶æ— éœ€å¤„ç† idï¼ˆUserRdb å·²ç§»é™¤ idï¼‰
  // æ–°å¢ï¼šåŠ è½½ç”¨æˆ·ä¿¡æ¯å‰å…ˆåˆå§‹åŒ–æ•°æ®åº“ï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰
  private async loadUserInfo(): Promise<void> {
    try {
      console.info('å¼€å§‹ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼ˆæ—  id å­—æ®µï¼‰');
      this.isUserInfoLoading = true;

      // å…³é”®ï¼šå…ˆåˆå§‹åŒ–æ•°æ®åº“ï¼ˆè·å–ä¸Šä¸‹æ–‡ï¼Œè¿™é‡Œå‡è®¾ä½ èƒ½æ‹¿åˆ° UIAbilityContextï¼‰
      // æ³¨æ„ï¼šå¦‚æœ MinePage æ²¡æœ‰ç›´æ¥çš„ contextï¼Œéœ€è¦ä» EntryAbility æˆ–å…¨å±€è·å–
      const context = getContext(this) as common.UIAbilityContext;
      await userInfoRdb.getRdbStore(context);

      // å†æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
      const userInfo = await userInfoRdb.queryUserInfo();
      this.userInfo = userInfo;
      this.nicknameInput = userInfo.nickname; // åŒæ­¥åˆ°ç¼–è¾‘æ¡†
      console.info('åŠ è½½ç”¨æˆ·ä¿¡æ¯æˆåŠŸ:', JSON.stringify(userInfo));
    } catch (error) {
      console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error.message);
      // åŠ è½½å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼ˆæ—  idï¼‰
      this.userInfo = {
        avatar: 'ğŸ‘¤',
        nickname: 'è½»ç‰©å¿—ç”¨æˆ·',
        joinDate: '2026å¹´1æœˆ'
      };
      this.nicknameInput = this.userInfo.nickname;
      this.showErrorToast('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥');
    } finally {
      this.isUserInfoLoading = false;
    }
  }

  // ========== å…¨å±€çŠ¶æ€å¤„ç† ==========
  private handleItemCountChange = (count: number): void => {
    console.info(`æ¥æ”¶åˆ°å…¨å±€çŠ¶æ€æ›´æ–°: ${count}ä¸ªç‰©å“`);
    this.itemCount = count;
    this.isLoading = false;
  };

  private async loadFromStore(): Promise<void> {
    console.info('ä»å…¨å±€çŠ¶æ€åŠ è½½ç‰©å“æ•°é‡');
    try {
      const count = await itemStore.getItemCount();
      this.itemCount = count;
      await itemStore.updateItemCount();
    } catch (error) {
      console.error('åŠ è½½ç‰©å“æ•°é‡å¤±è´¥:', error.message);
      this.itemCount = 0;
    }
  }

  // ========== æ ¸å¿ƒåŠŸèƒ½æ–¹æ³• ==========
  private async handleClearData(): Promise<void> {
    console.info('ç‚¹å‡»æ¸…ç©ºæ•°æ®æŒ‰é’®');
    try {
      const count = await itemStore.getItemCount();
      this.itemCount = count;

      if (this.itemCount === 0) {
        this.showNoDataDialog = true;
      } else {
        this.showConfirmDialog = true;
      }
    } catch (error) {
      console.error('æ£€æŸ¥ç‰©å“æ•°é‡å¤±è´¥:', error.message);
      this.showErrorToast('æ£€æŸ¥æ•°æ®å¤±è´¥');
    }
  }

  private async executeClearData(): Promise<void> {
    if (this.isClearing) {
      return;
    }
    this.isClearing = true;
    this.showConfirmDialog = false;
    try {
      console.info('å¼€å§‹æ¸…ç©ºæ•°æ®åº“...');
      await itemStore.clearAllItems();
      console.info('æ•°æ®åº“æ¸…ç©ºæˆåŠŸ');
      this.itemCount = 0;
      this.showSuccessDialog = true;
    } catch (error) {
      console.error('æ¸…ç©ºæ•°æ®å¤±è´¥:', error.message);
      this.showErrorToast('æ¸…ç©ºå¤±è´¥ï¼Œè¯·é‡è¯•');
    } finally {
      this.isClearing = false;
    }
  }

  // ========== å¤´åƒé€‰æ‹©åŠŸèƒ½ï¼ˆæ ¸å¿ƒé€‚é…ï¼šæ—  id æ›´æ–°ï¼‰ ==========
  // æ‰“å¼€å¤´åƒé€‰æ‹©å¼¹çª—
  private openAvatarSelectDialog(): void {
    this.showEditDialog = false;
    this.showAvatarSelectDialog = true;
  }

  // é€‰æ‹©é¢„è®¾è¡¨æƒ…å¤´åƒï¼ˆæ— éœ€ä¼ é€’ idï¼ŒUserRdb å·²ç§»é™¤ id æ¡ä»¶ï¼‰
  private async selectAvatar(avatar: string): Promise<void> {
    try {
      // ç›´æ¥æ›´æ–°å¤´åƒï¼ŒUserRdb å†…éƒ¨æ— éœ€ id æ¡ä»¶
      await userInfoRdb.updateAvatar(avatar);
      // æ›´æ–°é¡µé¢çŠ¶æ€ï¼ˆæ—  id ç›¸å…³å¤„ç†ï¼‰
      this.userInfo.avatar = avatar;
      this.showAvatarSelectDialog = false;
      this.showToast('å¤´åƒæ›´æ¢æˆåŠŸ');
    } catch (error) {
      console.error('æ›´æ¢å¤´åƒå¤±è´¥:', error.message);
      this.showErrorToast('æ›´æ¢å¤´åƒå¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  }

  // ä»ç›¸å†Œé€‰æ‹©å¤´åƒï¼ˆæ— éœ€ä¼ é€’ idï¼‰
  private async selectAvatarFromAlbum(): Promise<void> {
    try {
      const photoPicker = new picker.PhotoViewPicker();
      const selectOptions = new picker.PhotoSelectOptions();
      // é…ç½®é€‰æ‹©å‚æ•°ï¼šä»…é€‰1å¼ å›¾ç‰‡ï¼Œåªé€‰å›¾ç‰‡ç±»å‹
      selectOptions.maxSelectNumber = 1;
      selectOptions.MIMEType = picker.PhotoViewMIMETypes.IMAGE_TYPE;

      // è°ƒç”¨é€‰æ‹©å™¨
      const result = await photoPicker.select(selectOptions);

      // å¤„ç†é€‰æ‹©ç»“æœ
      if (result.photoUris && result.photoUris.length > 0) {
        const imageUri = result.photoUris[0];
        // ç›´æ¥æ›´æ–°å¤´åƒï¼Œæ— éœ€ id
        await userInfoRdb.updateAvatar(imageUri);
        // æ›´æ–°é¡µé¢çŠ¶æ€
        this.userInfo.avatar = imageUri;
        this.showAvatarSelectDialog = false;
        promptAction.showToast({ message: 'å¤´åƒé€‰æ‹©æˆåŠŸ', duration: 1500 });
      }
    } catch (err) {
      console.error("é€‰æ‹©å¤´åƒå›¾ç‰‡å¤±è´¥:", err.message);
      promptAction.showToast({ message: 'å¤´åƒé€‰æ‹©å¤±è´¥ï¼Œè¯·é‡è¯•', duration: 2000 });
    }
  }

  // ========== ç¼–è¾‘èµ„æ–™ç›¸å…³ï¼ˆæ ¸å¿ƒé€‚é…ï¼šæ—  id æ›´æ–°æ˜µç§°ï¼‰ ==========
  private handleEditProfile(): void {
    this.nicknameInput = this.userInfo.nickname;
    this.showEditDialog = true;
  }

  // ä¿å­˜æ˜µç§°ï¼ˆæ— éœ€ä¼ é€’ idï¼ŒUserRdb å†…éƒ¨æ—  id æ¡ä»¶ï¼‰
  private async saveNickname(): Promise<void> {
    try {
      const trimmedNickname = this.nicknameInput.trim();
      if (trimmedNickname.length === 0) {
        this.showErrorToast('æ˜µç§°ä¸èƒ½ä¸ºç©º');
        return;
      }
      if (trimmedNickname.length > 12) {
        this.showErrorToast('æ˜µç§°ä¸èƒ½è¶…è¿‡12ä¸ªå­—ç¬¦');
        return;
      }

      // ç›´æ¥æ›´æ–°æ˜µç§°ï¼ŒUserRdb å†…éƒ¨æ— éœ€ id æ¡ä»¶
      await userInfoRdb.updateNickname(trimmedNickname);
      // æ›´æ–°é¡µé¢çŠ¶æ€ï¼ˆæ—  id ç›¸å…³å¤„ç†ï¼‰
      this.userInfo.nickname = trimmedNickname;
      this.showEditDialog = false;
      this.showToast('æ˜µç§°ä¿®æ”¹æˆåŠŸ');
    } catch (error) {
      console.error('ä¿å­˜æ˜µç§°å¤±è´¥:', error.message);
      this.showErrorToast(error instanceof Error ? error.message : 'æ˜µç§°ä¿®æ”¹å¤±è´¥');
    }
  }

  // ========== æç¤ºå·¥å…·æ–¹æ³• ==========
  private showErrorToast(message: string): void {
    try {
      promptAction.showToast({
        message: message,
        duration: 1500
      });
    } catch (error) {
      console.error('æ˜¾ç¤ºToastå‡ºé”™:', error.message);
    }
  }

  private showToast(message: string): void {
    try {
      promptAction.showToast({
        message: message,
        duration: 1500
      });
    } catch (error) {
      console.error('æ˜¾ç¤ºToastå‡ºé”™:', error.message);
    }
  }

  private safeExecuteClearData(): void {
    this.executeClearData().catch((error: Error) => {
      console.error('æ‰§è¡Œæ¸…ç©ºæ“ä½œå‡ºé”™:', error.message);
    });
  }

  private safeHandleClearData(): void {
    this.handleClearData().catch((error: Error) => {
      console.error('å¤„ç†æ¸…ç©ºæ•°æ®å‡ºé”™:', error.message);
    });
  }

  // ========== æ„å»ºæ–¹æ³•ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼Œä»…ä¿ç•™é€‚é…æ³¨é‡Šï¼‰ ==========
  @Builder
  private buildLoadingPlaceholder() {
    Column() {
      LoadingProgress()
        .color('#4A6CF7')
        .width(24)
        .height(24)
      Text('åŠ è½½ä¸­...')
        .fontSize(12)
        .fontColor('#999')
        .margin({ top: 8 })
    }
    .width('100%')
    .height(24)
    .justifyContent(FlexAlign.Center)
  }

  // æ–°å¢ï¼šç”¨æˆ·ä¿¡æ¯åŠ è½½å ä½ç¬¦
  @Builder
  private buildUserInfoLoadingPlaceholder() {
    Column() {
      // å¤´åƒå ä½
      Column() {
        LoadingProgress()
          .color('#4A6CF7')
          .width(24)
          .height(24)
      }
      .width(80)
      .height(80)
      .backgroundColor('#F0F5FF')
      .borderRadius(40)
      .justifyContent(FlexAlign.Center)

      // æ˜µç§°å ä½
      Text('åŠ è½½ä¸­...')
        .fontSize(22)
        .fontWeight(FontWeight.Bold)
        .fontColor('#333')
        .margin({ top: 8 })
    }
    .width('100%')
    .justifyContent(FlexAlign.Center)
  }

  // ä¸ªäººèµ„æ–™å¡ç‰‡ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildUserInfoCard() {
    Column() {
      Row({ space: 16 }) {
        // å¤´åƒåŒºåŸŸï¼ˆå¯ç‚¹å‡»ï¼‰
        Column() {
          if (this.isUserInfoLoading) {
            // åŠ è½½ä¸­å ä½ç¬¦
            this.buildUserInfoLoadingPlaceholder()
          } else {
            // åŒºåˆ†æ˜¯è¡¨æƒ…å¤´åƒè¿˜æ˜¯å›¾ç‰‡å¤´åƒ
            if (this.userInfo.avatar.startsWith('file://') || this.userInfo.avatar.startsWith('data:image/')) {
              // å›¾ç‰‡å¤´åƒ
              Image(this.userInfo.avatar)
                .width(80)
                .height(80)
                .borderRadius(40)
                .objectFit(ImageFit.Cover)
                .backgroundColor('#F0F5FF')
                .shadow({ radius: 6, color: '#20000000', offsetY: 3 })
            } else {
              // è¡¨æƒ…å¤´åƒï¼ˆå¤„ç†ç©ºå€¼ï¼Œæ—  id ç›¸å…³ï¼‰
              Text(this.userInfo.avatar || 'ğŸ‘¤')
                .fontSize(40)
                .fontColor('#4A6CF7')
                .width(80)
                .height(80)
                .backgroundColor('#F0F5FF')
                .borderRadius(40)
                .textAlign(TextAlign.Center)
                .shadow({ radius: 6, color: '#20000000', offsetY: 3 })
            }
          }
        }
        .onClick(() => {
          if (!this.isUserInfoLoading) {
            this.openAvatarSelectDialog();
          }
        })

        // ç”¨æˆ·ä¿¡æ¯
        Column({ space: 8 }) {
          if (this.isUserInfoLoading) {
            // åŠ è½½ä¸­å ä½
            this.buildLoadingPlaceholder()
          } else {
            Row({ space: 4 }) {
              Text(this.userInfo.nickname || 'è½»ç‰©å¿—ç”¨æˆ·')
                .fontSize(22)
                .fontWeight(FontWeight.Bold)
                .fontColor('#333')
                .maxLines(1)
                .textOverflow({ overflow: TextOverflow.Ellipsis })
                .onClick(() => {
                  this.handleEditProfile();
                })

              Text('âœï¸')
                .fontSize(13)
                .fontColor('#CCCCCC')
                .margin({ left: 4 })
                .opacity(0.7)
                .onClick(() => {
                  this.handleEditProfile();
                })
            }
            .width('100%')
            .alignItems(VerticalAlign.Center)

            Row({ space: 24 }) {
              Column({ space: 2 }) {
                Text('åŠ å…¥æ—¶é—´')
                  .fontSize(12)
                  .fontColor('#666')
                Text(this.userInfo.joinDate || '2026å¹´1æœˆ')
                  .fontSize(14)
                  .fontColor('#333')
                  .fontWeight(FontWeight.Medium)
              }

              Column({ space: 2 }) {
                Text('ç‰©å“æ•°é‡')
                  .fontSize(12)
                  .fontColor('#666')
                if (this.isLoading) {
                  this.buildLoadingPlaceholder()
                } else {
                  Text(`${this.itemCount}ä¸ª`)
                    .fontSize(14)
                    .fontColor('#333')
                    .fontWeight(FontWeight.Medium)
                }
              }
            }
            .margin({ top: 8 })
          }
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
      }
      .padding({
        left: 20,
        right: 20,
        top: 24,
        bottom: 24
      })
    }
    .width('100%')
    .backgroundColor(Color.White)
    .borderRadius(20)
    .margin({ top: 16, bottom: 16 })
    .shadow({ radius: 12, color: '#10000000', offsetY: 4 })
  }

  // å¤´åƒé€‰æ‹©å¼¹çª—ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildAvatarSelectDialog() {
    Column() {
      Column() {
        // æ ‡é¢˜æ ï¼ˆå…³é—­æŒ‰é’®+æ ‡é¢˜ï¼‰
        Row() {
          Text('æ›´æ¢å¤´åƒ')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#333')
          Text('âœ•')
            .fontSize(18)
            .fontColor('#999')
            .onClick(() => {
              this.showAvatarSelectDialog = false;
            })
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceBetween)
        .margin({ bottom: 20 })

        // æ ¸å¿ƒä¿®å¤ï¼šç”¨å¤–å±‚ Column åŒ…è£¹ Gridï¼Œé™åˆ¶æœ€å¤§é«˜åº¦
        Column() {
          Grid() {
            ForEach(this.avatarLibrary, (avatar: string) => {
              GridItem() {
                Column() {
                  Text(avatar)
                    .fontSize(32)
                  // é€‰ä¸­çŠ¶æ€æ ‡è¯†ï¼ˆæ—  id ç›¸å…³ï¼‰
                  if (avatar === this.userInfo.avatar) {
                    Text('âœ“')
                      .fontSize(12)
                      .fontColor('#4A6CF7')
                      .backgroundColor(Color.White)
                      .borderRadius(10)
                      .width(20)
                      .height(20)
                      .position({ right: 0, bottom: 0 })
                  }
                }
                .width(60)
                .height(60)
                .justifyContent(FlexAlign.Center)
                .alignItems(HorizontalAlign.Center)
                .backgroundColor(this.userInfo.avatar === avatar ? '#E6EEFF' : '#F9FAFB')
                .borderRadius(30)
                .onClick(() => {
                  this.selectAvatar(avatar);
                })
              }
            })
          }
          .columnsTemplate('1fr 1fr 1fr 1fr 1fr')
          .columnsGap(12)
          .rowsGap(12)
          .width('100%') // Grid å®½åº¦å……æ»¡å®¹å™¨
          .height('100%') // Grid é«˜åº¦è‡ªé€‚åº”å¤–å±‚å®¹å™¨
        }
        .height(144) // å¤–å±‚å®¹å™¨é™åˆ¶æœ€å¤§é«˜åº¦ï¼ˆ2è¡ŒÃ—60+12é—´éš™ï¼‰
        .width('100%')
        .margin({ bottom: 20 })

        // ä»ç›¸å†Œé€‰æ‹©æŒ‰é’®ï¼ˆç¡®ä¿æ ·å¼å¯è§ï¼‰
        Button('ä»ç›¸å†Œé€‰æ‹©')
          .width('100%')
          .height(44)
          .backgroundColor('#F0F2F5')
          .fontColor('#666')
          .fontSize(14)
          .borderRadius(8)
          .opacity(1)
          .visibility(Visibility.Visible)
          .onClick(async () => {
            await this.selectAvatarFromAlbum();
          })
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .margin({ left: 24, right: 24 })
      .height('60%') // å¼¹çª—å†…å®¹æœ€å¤§é«˜åº¦ï¼ˆArkTS æ”¯æŒ Column çš„ maxHeightï¼‰
      .width('80%')
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(104)
  }

  // ç¼–è¾‘èµ„æ–™å¯¹è¯æ¡†ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildEditDialog() {
    Column() {
      Column() {
        Text('ç¼–è¾‘èµ„æ–™')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333')
          .margin({ bottom: 20 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // å¤´åƒåŒºåŸŸï¼ˆå¯ç‚¹å‡»ï¼‰
        Row() {
          Column() {
            if (this.isUserInfoLoading) {
              // åŠ è½½ä¸­å ä½
              this.buildUserInfoLoadingPlaceholder()
            } else {
              if (this.userInfo.avatar.startsWith('file://') || this.userInfo.avatar.startsWith('data:image/')) {
                // å›¾ç‰‡å¤´åƒ
                Image(this.userInfo.avatar)
                  .width(64)
                  .height(64)
                  .borderRadius(32)
                  .objectFit(ImageFit.Cover)
                  .backgroundColor('#F0F5FF')
              } else {
                // è¡¨æƒ…å¤´åƒï¼ˆå¤„ç†ç©ºå€¼ï¼Œæ—  idï¼‰
                Text(this.userInfo.avatar || 'ğŸ‘¤')
                  .fontSize(32)
                  .fontColor('#4A6CF7')
                  .width(64)
                  .height(64)
                  .backgroundColor('#F0F5FF')
                  .borderRadius(32)
                  .textAlign(TextAlign.Center)
              }
              Text('ç‚¹å‡»æ›´æ¢')
                .fontSize(12)
                .fontColor('#999')
                .margin({ top: 8 })
            }
          }
          .onClick(() => {
            if (!this.isUserInfoLoading) {
              this.openAvatarSelectDialog();
            }
          })
        }
        .width('100%')
        .margin({ bottom: 20 })
        .justifyContent(FlexAlign.Center)

        // æ˜µç§°ç¼–è¾‘
        Column() {
          Text('æ˜µç§°')
            .fontSize(14)
            .fontColor('#666')
            .margin({ bottom: 8 })
            .width('100%')
            .textAlign(TextAlign.Start)

          TextInput({
            text: this.nicknameInput || '',
            placeholder: 'è¯·è¾“å…¥æ˜µç§°'
          })
            .width('100%')
            .height(44)
            .backgroundColor('#F8F9FA')
            .fontSize(15)
            .fontColor('#333')
            .placeholderColor('#999')
            .placeholderFont({ size: 15, weight: FontWeight.Normal })
            .maxLength(12)
            .borderRadius(8)
            .padding({ left: 12, right: 12 })
            .onChange((value: string) => {
              this.nicknameInput = value;
            })
        }
        .width('100%')
        .margin({ bottom: 24 })

        // æŒ‰é’®åŒºåŸŸ
        Row() {
          Button('å–æ¶ˆ')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#F0F2F5')
            .fontColor('#666')
            .fontSize(14)
            .borderRadius(8)
            .onClick(() => {
              this.showEditDialog = false;
            })

          Button('ä¿å­˜')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#4A6CF7')
            .fontColor(Color.White)
            .fontSize(14)
            .borderRadius(8)
            .margin({ left: 12 })
            .onClick(() => {
              this.saveNickname();
            })
        }
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .margin({ left: 24, right: 24 })
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(103)
  }

  // æ•°æ®ç®¡ç†å¡ç‰‡ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildDataManagementCard() {
    Column() {
      Text('æ•°æ®ç®¡ç†')
        .fontSize(14)
        .fontColor('#666')
        .margin({ bottom: 8 })
        .width('100%')

      Column() {
        Row() {
          Text('ğŸ—‘ï¸')
            .fontSize(20)
            .margin({ right: 12 })
            .width(24)

          Column({ space: 2 }) {
            Text('æ¸…ç©ºæ‰€æœ‰æ•°æ®')
              .fontSize(16)
              .fontColor('#333')
              .fontWeight(FontWeight.Medium)
            Text('æ°¸ä¹…åˆ é™¤æ‰€æœ‰ç‰©å“è®°å½•')
              .fontSize(12)
              .fontColor('#999')
          }
          .layoutWeight(1)

          Text('â€º')
            .fontSize(20)
            .fontColor('#999')
        }
        .width('100%')
        .height(56)
        .alignItems(VerticalAlign.Center)
        .onClick(() => {
          this.safeHandleClearData();
        })
      }
      .width('100%')
      .backgroundColor(Color.White)
      .borderRadius(12)
      .padding(12)
      .shadow({ radius: 4, color: '#0D000000', offsetY: 2 })
    }
    .width('100%')
    .margin({ bottom: 16 })
  }

  // å…³äºä¸å¸®åŠ©å¡ç‰‡ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildAboutCard() {
    Column() {
      Text('å…³äºä¸å¸®åŠ©')
        .fontSize(14)
        .fontColor('#666')
        .margin({ bottom: 8 })
        .width('100%')

      Column() {
        Row() {
          Text('ğŸ“±')
            .fontSize(20)
            .margin({ right: 12 })
            .width(24)

          Column({ space: 2 }) {
            Text(this.appInfo.name)
              .fontSize(16)
              .fontColor('#333')
              .fontWeight(FontWeight.Medium)
            Text('ç‰ˆæœ¬ ' + this.appInfo.version)
              .fontSize(12)
              .fontColor('#999')
          }
          .layoutWeight(1)
        }
        .width('100%')
        .height(56)
        .alignItems(VerticalAlign.Center)

        Divider()
          .color('#F0F0F0')
          .margin({ left: 36, right: 0 })

        Row() {
          Text('ğŸ¯')
            .fontSize(20)
            .margin({ right: 12 })
            .width(24)

          Column({ space: 2 }) {
            Text('å¸®åŠ©')
              .fontSize(16)
              .fontColor('#333')
              .fontWeight(FontWeight.Medium)
            Text('ä½¿ç”¨æ•™ç¨‹ä¸æ“ä½œæŒ‡å—')
              .fontSize(12)
              .fontColor('#999')
          }
          .layoutWeight(1)

          Text('â€º')
            .fontSize(20)
            .fontColor('#999')
        }
        .width('100%')
        .height(56)
        .alignItems(VerticalAlign.Center)
        .onClick(() => {
          this.showHelpDialog = true;
        })

        Divider()
          .color('#F0F0F0')
          .margin({ left: 36, right: 0 })

        Row() {
          Text('ğŸ‘¨â€ğŸ’»')
            .fontSize(20)
            .margin({ right: 12 })
            .width(24)

          Column({ space: 2 }) {
            Text('å¼€å‘è€…ä¿¡æ¯')
              .fontSize(16)
              .fontColor('#333')
              .fontWeight(FontWeight.Medium)
            Text(this.appInfo.developer)
              .fontSize(12)
              .fontColor('#999')
          }
          .layoutWeight(1)
        }
        .width('100%')
        .height(56)
        .alignItems(VerticalAlign.Center)
      }
      .width('100%')
      .backgroundColor(Color.White)
      .borderRadius(12)
      .padding(12)
      .shadow({ radius: 4, color: '#0D000000', offsetY: 2 })
    }
    .width('100%')
    .margin({ bottom: 16 })
  }

  // åº•éƒ¨ä¿¡æ¯ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildFooter() {
    Column() {
      Text(this.appInfo.copyright)
        .fontSize(12)
        .fontColor('#999')
      Text('åŸºäº OpenHarmony å¼€å‘')
        .fontSize(12)
        .fontColor('#999')
        .margin({ top: 4 })
    }
    .width('100%')
    .padding({ top: 24, bottom: 32 })
    .alignItems(HorizontalAlign.Center)
  }

  // æ¸…ç©ºæ•°æ®ç¡®è®¤å¯¹è¯æ¡†ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildConfirmDialog() {
    Column() {
      Column() {
        Text('ç¡®è®¤æ¸…ç©ºæ•°æ®')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333')
          .margin({ bottom: 12 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Text('âš ï¸')
          .fontSize(48)
          .margin({ bottom: 16 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Text(`å½“å‰å…±æœ‰ ${this.itemCount} ä¸ªç‰©å“è®°å½•`)
          .fontSize(14)
          .fontColor('#666')
          .margin({ bottom: 16 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Text('æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ‰€æœ‰ç‰©å“æ•°æ®ï¼Œä¸”æ— æ³•æ¢å¤ï¼')
          .fontSize(14)
          .fontColor('#F53F3F')
          .margin({ bottom: 24 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Row() {
          Button('å–æ¶ˆ')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#F0F2F5')
            .fontColor('#666')
            .fontSize(14)
            .borderRadius(8)
            .onClick(() => {
              console.info('å–æ¶ˆæ¸…ç©ºæ•°æ®');
              this.showConfirmDialog = false;
            })

          Button('ç¡®è®¤æ¸…ç©º')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#F53F3F')
            .fontColor(Color.White)
            .fontSize(14)
            .borderRadius(8)
            .margin({ left: 12 })
            .onClick(() => {
              this.safeExecuteClearData();
            })
        }
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .margin({ left: 24, right: 24 })
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(100)
  }

  // æ— æ•°æ®æç¤ºå¯¹è¯æ¡†ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildNoDataDialog() {
    Column() {
      Column() {
        Text('ğŸ“­')
          .fontSize(48)
          .margin({ bottom: 16 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Text('æš‚æ— æ•°æ®')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333')
          .margin({ bottom: 8 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Text('å½“å‰æ²¡æœ‰ç‰©å“è®°å½•ï¼Œæ— éœ€æ¸…ç©º')
          .fontSize(14)
          .fontColor('#666')
          .margin({ bottom: 24 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Button('çŸ¥é“äº†')
          .width('100%')
          .height(44)
          .backgroundColor('#4A6CF7')
          .fontColor(Color.White)
          .fontSize(14)
          .borderRadius(8)
          .onClick(() => {
            this.showNoDataDialog = false;
          })
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .margin({ left: 24, right: 24 })
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(101)
  }

  // æ¸…ç©ºæˆåŠŸå¯¹è¯æ¡†ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildSuccessDialog() {
    Column() {
      Column() {
        Text('âœ…')
          .fontSize(48)
          .margin({ bottom: 16 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Text('æ•°æ®å·²æ¸…ç©º')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333')
          .margin({ bottom: 8 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Text('æ‰€æœ‰ç‰©å“æ•°æ®å·²è¢«å®‰å…¨æ¸…é™¤')
          .fontSize(14)
          .fontColor('#666')
          .margin({ bottom: 24 })
          .width('100%')
          .textAlign(TextAlign.Center)

        Button('çŸ¥é“äº†')
          .width('100%')
          .height(44)
          .backgroundColor('#4A6CF7')
          .fontColor(Color.White)
          .fontSize(14)
          .borderRadius(8)
          .onClick(() => {
            this.showSuccessDialog = false;
          })
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .margin({ left: 24, right: 24 })
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(102)
  }

  // å¸®åŠ©å¯¹è¯æ¡†ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildHelpDialog() {
    Column() {
      Column() {
        Row() {
          Text('ğŸ¯')
            .fontSize(24)
            .margin({ right: 8 })
          Text('ä½¿ç”¨å¸®åŠ©')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#333')
        }
        .width('100%')
        .margin({ bottom: 20 })
        .justifyContent(FlexAlign.Start)

        Scroll() {
          Column({ space: 16 }) {
            Column() {
              Text('æ¬¢è¿ä½¿ç”¨è½»ç‰©å¿—ï¼ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ã€‚')
                .fontSize(13)
                .fontColor('#666')
                .lineHeight(18)
            }
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)
            .width('100%')

            Row({ space: 12 }) {
              Column() {
                Text('1')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#4A6CF7')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('æ·»åŠ ç‰©å“')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('ç‚¹å‡»åº•éƒ¨"æ·»åŠ "æ ‡ç­¾ â†’ å¡«å†™ç‰©å“ä¿¡æ¯ â†’ é€‰æ‹©åˆ†ç±» â†’ ç‚¹å‡»"æ·»åŠ ç‰©å“"æŒ‰é’®å®Œæˆ')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            Row({ space: 12 }) {
              Column() {
                Text('2')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#34C759')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('æŸ¥çœ‹ä¸æœç´¢')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('ç‚¹å‡»"ç‰©å“åˆ—è¡¨"æŸ¥çœ‹æ‰€æœ‰ç‰©å“ â†’ ä½¿ç”¨é¡¶éƒ¨æœç´¢æ¡†å¿«é€ŸæŸ¥æ‰¾ â†’ æ”¯æŒæŒ‰åç§°ã€åˆ†ç±»ã€ä½ç½®æœç´¢')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            Row({ space: 12 }) {
              Column() {
                Text('3')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#FF9500')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('ç¼–è¾‘ä¸åˆ é™¤')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('åœ¨ç‰©å“åˆ—è¡¨å‘å·¦æ»‘åŠ¨ â†’ ç‚¹å‡»"ç¼–è¾‘"ä¿®æ”¹ä¿¡æ¯ â†’ ç‚¹å‡»"åˆ é™¤"ç§»é™¤è®°å½•')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            Row({ space: 12 }) {
              Column() {
                Text('4')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#5856D6')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('æŸ¥çœ‹ç»Ÿè®¡')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('ç‚¹å‡»"ç»Ÿè®¡"æ ‡ç­¾ â†’ æŸ¥çœ‹ç‰©å“åˆ†ç±»åˆ†å¸ƒ â†’ åˆ†æä½¿ç”¨çŠ¶æ€ç»Ÿè®¡ â†’ å›¾è¡¨å¯è§†åŒ–å±•ç¤º')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            Row({ space: 12 }) {
              Column() {
                Text('5')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#FF2D55')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('ç®¡ç†æ•°æ®')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('è¿›å…¥"æˆ‘çš„"é¡µé¢ â†’ ç‚¹å‡»"æ¸…ç©ºæ‰€æœ‰æ•°æ®" â†’ ç¡®è®¤åå®‰å…¨åˆ é™¤æ‰€æœ‰è®°å½•')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            Column() {
              Row() {
                Text('ğŸ’¡')
                  .fontSize(16)
                  .margin({ right: 8 })
                Text('ä½¿ç”¨å»ºè®®')
                  .fontSize(14)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
              }
              .width('100%')
              .margin({ bottom: 8 })

              Text('â€¢ ä¸ºç‰©å“é€‰æ‹©åˆé€‚çš„åˆ†ç±»ï¼Œæ–¹ä¾¿åç»­æŸ¥æ‰¾å’Œç®¡ç†\nâ€¢ è¯¦ç»†è®°å½•ç‰©å“ä½ç½®ï¼Œéœ€è¦æ—¶èƒ½å¿«é€Ÿæ‰¾åˆ°\nâ€¢ å®šæœŸä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½äº†è§£ç‰©å“åˆ†å¸ƒæƒ…å†µ\nâ€¢ é‡è¦ç‰©å“å¯æ·»åŠ è¯¦ç»†å¤‡æ³¨ä¿¡æ¯')
                .fontSize(12)
                .fontColor('#666')
                .lineHeight(18)
            }
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)
            .width('100%')
          }
          .padding({ right: 4 })
        }
        .layoutWeight(1)
        .margin({ bottom: 20 })
        .scrollBar(BarState.Auto)

        Button('å¼€å§‹ä½¿ç”¨')
          .width('100%')
          .height(44)
          .backgroundColor('#4A6CF7')
          .fontColor(Color.White)
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .borderRadius(8)
          .onClick(() => {
            this.showHelpDialog = false;
          })
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .width('90%')
      .height('75%')
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(201)
  }

  // åŠ è½½ä¸­é®ç½©ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰
  @Builder
  private buildLoadingOverlay() {
    Column() {
      LoadingProgress()
        .color(Color.White)
        .width(48)
        .height(48)

      Text('æ­£åœ¨æ¸…ç©ºæ•°æ®...')
        .fontSize(16)
        .fontColor(Color.White)
        .margin({ top: 16 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(300)
  }

  // ========== ä¸»æ„å»ºæ–¹æ³•ï¼ˆæ—  id ç›¸å…³ä¿®æ”¹ï¼‰ ==========
  build() {
    Column() {
      // æ»šåŠ¨å†…å®¹åŒºåŸŸ
      Scroll() {
        Column() {
          this.buildUserInfoCard()
          this.buildDataManagementCard()
          this.buildAboutCard()
          this.buildFooter()
        }
        .padding({ left: 16, right: 16, bottom: 32 })
      }
      .scrollBar(BarState.Off)
      .layoutWeight(1)

      // å¼¹çª—å’Œé®ç½©å±‚
      if (this.showConfirmDialog) {
        this.buildConfirmDialog()
      }
      if (this.showNoDataDialog) {
        this.buildNoDataDialog()
      }
      if (this.showSuccessDialog) {
        this.buildSuccessDialog()
      }
      if (this.showEditDialog) {
        this.buildEditDialog()
      }
      if (this.showHelpDialog) {
        this.buildHelpDialog()
      }
      if (this.showAvatarSelectDialog) {
        this.buildAvatarSelectDialog()
      }
      if (this.isClearing) {
        this.buildLoadingOverlay()
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F9FAFB')
  }
}