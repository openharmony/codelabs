import { promptAction } from '@kit.ArkUI';
import { UserInfo, AppInfo } from '../model/types';
import { itemStore } from '../store';

@Component
export struct MinePage {
  // é¡µé¢çŠ¶æ€
  @State showConfirmDialog: boolean = false;
  @State showNoDataDialog: boolean = false;
  @State showSuccessDialog: boolean = false;
  @State showHelpDialog: boolean = false;
  @State showEditDialog: boolean = false;
  @State nicknameInput: string = 'è½»ç‰©å¿—ç”¨æˆ·';
  @State isClearing: boolean = false;
  @State itemCount: number = 0;

  // ç”¨æˆ·ä¿¡æ¯
  @State userInfo: UserInfo = {
    avatar: 'ğŸ‘¤',
    nickname: 'è½»ç‰©å¿—ç”¨æˆ·',
    joinDate: '2026å¹´1æœˆ'
  };

  // åº”ç”¨ä¿¡æ¯
  private appInfo: AppInfo = {
    name: 'è½»ç‰©å¿—',
    version: '1.0.0',
    description: 'æ™ºèƒ½ç‰©å“ç®¡ç†åŠ©æ‰‹',
    developer: 'OpenHarmonyè¯¾ç¨‹å°ç»„',
    copyright: 'Â© 2026 OpenHarmonyè¯¾ç¨‹å°ç»„'
  };

  // ========== é¡µé¢ç”Ÿå‘½å‘¨æœŸ ==========
  // é¡µé¢æ˜¾ç¤ºæ—¶
  aboutToAppear(): void {
    console.info('æˆ‘çš„é¡µé¢æ˜¾ç¤º');
    // é¦–æ¬¡åŠ è½½ï¼šä»å…¨å±€çŠ¶æ€è·å–æ•°æ®
    this.loadFromStore();
    // ç›‘å¬å…¨å±€çŠ¶æ€å˜åŒ–
    itemStore.onItemCountChange(this.handleItemCountChange);
  }

  // é¡µé¢æ¶ˆå¤±æ—¶
  aboutToDisappear(): void {
    console.info('æˆ‘çš„é¡µé¢æ¶ˆå¤±');
    // ç§»é™¤å…¨å±€çŠ¶æ€ç›‘å¬
    itemStore.offItemCountChange(this.handleItemCountChange);
  }

  // ========== å…¨å±€çŠ¶æ€å¤„ç† ==========
  // å¤„ç†ç‰©å“æ•°é‡å˜åŒ–ï¼ˆç›‘å¬å›è°ƒï¼‰
  private handleItemCountChange = (count: number): void => {
    console.info(`æ¥æ”¶åˆ°å…¨å±€çŠ¶æ€æ›´æ–°: ${count}ä¸ªç‰©å“`);
    this.itemCount = count;
  };

  // ä»å…¨å±€çŠ¶æ€åŠ è½½æ•°æ®
  private async loadFromStore(): Promise<void> {
    console.info('ä»å…¨å±€çŠ¶æ€åŠ è½½ç‰©å“æ•°é‡');
    // æ›´æ–°å…¨å±€çŠ¶æ€ï¼ˆä¼šè§¦å‘ç›‘å¬å›è°ƒï¼‰
    await itemStore.updateItemCount();
  }

  // ========== æ ¸å¿ƒåŠŸèƒ½æ–¹æ³• ==========
  // å¤„ç†æ¸…ç©ºæ•°æ® - æ€»æ˜¯å…ˆæ£€æŸ¥
  private async handleClearData(): Promise<void> {
    console.info('ç‚¹å‡»æ¸…ç©ºæ•°æ®æŒ‰é’®');
    try {
      // æ€»æ˜¯å…ˆåˆ·æ–°ç‰©å“æ•°é‡ï¼ˆä»å…¨å±€çŠ¶æ€ï¼‰
      await itemStore.updateItemCount();
      if (this.itemCount === 0) {
        // æ²¡æœ‰æ•°æ®ï¼Œæç¤ºç”¨æˆ·
        this.showNoDataDialog = true;
      } else {
        // æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        this.showConfirmDialog = true;
      }
    } catch (error) {
      console.error('æ£€æŸ¥ç‰©å“æ•°é‡å¤±è´¥:', error);
      this.showErrorToast('æ£€æŸ¥æ•°æ®å¤±è´¥');
    }
  }

  // æ‰§è¡Œæ¸…ç©ºæ“ä½œ - ä½¿ç”¨ ItemStore çš„æ–¹æ³•
  private async executeClearData(): Promise<void> {
    if (this.isClearing) {
      return; // é˜²æ­¢é‡å¤ç‚¹å‡»
    }
    this.isClearing = true;
    this.showConfirmDialog = false;
    try {
      console.info('å¼€å§‹æ¸…ç©ºæ•°æ®åº“...');
      // ä½¿ç”¨ ItemStore çš„æ–¹æ³•æ¸…ç©ºæ•°æ®åº“
      await itemStore.clearAllItems();
      console.info('æ•°æ®åº“æ¸…ç©ºæˆåŠŸ');
      // æ˜¾ç¤ºæˆåŠŸæç¤º
      this.showSuccessDialog = true;
    } catch (error) {
      console.error('æ¸…ç©ºæ•°æ®å¤±è´¥:', error);
      this.showErrorToast('æ¸…ç©ºå¤±è´¥ï¼Œè¯·é‡è¯•');
    } finally {
      this.isClearing = false;
    }
  }

  // æ˜¾ç¤ºé”™è¯¯æç¤º
  private showErrorToast(message: string): void {
    try {
      promptAction.showToast({
        message: message,
        duration: 1500
      });
    } catch (error) {
      console.error('æ˜¾ç¤ºToastå‡ºé”™:', error);
    }
  }

  // å¤„ç†ç¼–è¾‘èµ„æ–™
  private handleEditProfile(): void {
    this.nicknameInput = this.userInfo.nickname;
    this.showEditDialog = true;
  }

  // ä¿å­˜æ˜µç§°ä¿®æ”¹
  private saveNickname(): void {
    if (this.nicknameInput.trim().length === 0) {
      this.showErrorToast('æ˜µç§°ä¸èƒ½ä¸ºç©º');
      return;
    }
    if (this.nicknameInput.length > 12) {
      this.showErrorToast('æ˜µç§°ä¸èƒ½è¶…è¿‡12ä¸ªå­—ç¬¦');
      return;
    }
    // æ›´æ–° @State å˜é‡ï¼Œè§¦å‘UIåˆ·æ–°
    this.userInfo.nickname = this.nicknameInput.trim();
    this.showEditDialog = false;
    this.showToast('æ˜µç§°ä¿®æ”¹æˆåŠŸ');
  }

  // æ˜¾ç¤ºToastæ¶ˆæ¯
  private showToast(message: string): void {
    try {
      promptAction.showToast({
        message: message,
        duration: 1500
      });
    } catch (error) {
      console.error('æ˜¾ç¤ºToastå‡ºé”™:', error);
    }
  }

  // å®‰å…¨æ‰§è¡Œæ¸…ç©ºæ“ä½œ
  private safeExecuteClearData(): void {
    this.executeClearData().catch((error: Error) => {
      console.error('æ‰§è¡Œæ¸…ç©ºæ“ä½œå‡ºé”™:', error);
    });
  }

  // å®‰å…¨å¤„ç†æ¸…ç©ºæ•°æ®
  private safeHandleClearData(): void {
    this.handleClearData().catch((error: Error) => {
      console.error('å¤„ç†æ¸…ç©ºæ•°æ®å‡ºé”™:', error);
    });
  }

  // ========== ä¸»è¦æ„å»ºæ–¹æ³• ==========
  // ä¸ªäººèµ„æ–™
  @Builder
  private buildUserInfoCard() {
    Column() {
      Row({ space: 16 }) {
        // ç®€çº¦å¤´åƒ
        Column() {
          Column() {
            Text('ğŸ‘¤')
              .fontSize(40)
              .fontColor('#4A6CF7')
          }
          .width(80)
          .height(80)
          .backgroundColor('#F0F5FF')
          .borderRadius(40)
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
          .shadow({ radius: 6, color: '#20000000', offsetY: 3 })
        }
        .width(80)
        .height(80)

        // ç”¨æˆ·ä¿¡æ¯
        Column({ space: 8 }) {
          // æ˜µç§°å’Œç¼–è¾‘å›¾æ ‡ï¼ˆå†…è”è®¾è®¡ï¼‰
          Row({ space: 4 }) {
            // æ˜µç§°ï¼ˆå¯ç‚¹å‡»ï¼‰
            Text(this.userInfo.nickname)
              .fontSize(22)
              .fontWeight(FontWeight.Bold)
              .fontColor('#333')
              .maxLines(1)
              .textOverflow({ overflow: TextOverflow.Ellipsis })
              .onClick(() => {
                this.handleEditProfile();
              })

            // å°ç¬”å›¾æ ‡ï¼ˆå¯ç‚¹å‡»ï¼‰
            Text('âœï¸')
              .fontSize(13)
              .fontColor('#CCCCCC')
              .margin({ left: 4 })
              .opacity(0.7)
              .onClick(() => {
                this.handleEditProfile();
              })
          }
          .width('100%')
          .alignItems(VerticalAlign.Center)

          // åŠ å…¥æ—¶é—´å’Œç‰©å“æ•°é‡
          Row({ space: 24 }) {
            Column({ space: 2 }) {
              Text('åŠ å…¥æ—¶é—´')
                .fontSize(12)
                .fontColor('#666')
              Text(this.userInfo.joinDate)
                .fontSize(14)
                .fontColor('#333')
                .fontWeight(FontWeight.Medium)
            }

            Column({ space: 2 }) {
              Text('ç‰©å“æ•°é‡')
                .fontSize(12)
                .fontColor('#666')
              Text(`${this.itemCount}ä¸ª`)
                .fontSize(14)
                .fontColor('#333')
                .fontWeight(FontWeight.Medium)
            }
          }
          .margin({ top: 8 })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
      }
      .padding({ left: 20, right: 20, top: 24, bottom: 24 })
    }
    .width('100%')
    .backgroundColor(Color.White)
    .borderRadius(20)
    .margin({ top: 16, bottom: 16 })
    .shadow({ radius: 12, color: '#10000000', offsetY: 4 })
  }

  // æ•°æ®ç®¡ç†å¡ç‰‡
  @Builder
  private buildDataManagementCard() {
    Column() {
      Text('æ•°æ®ç®¡ç†')
        .fontSize(14)
        .fontColor('#666')
        .margin({ bottom: 8 })
        .width('100%')

      Column() {
        // ç›´æ¥æ„å»ºæ¸…ç©ºæ•°æ®é¡¹
        Row() {
          // å›¾æ ‡
          Text('ğŸ—‘ï¸')
            .fontSize(20)
            .margin({ right: 12 })
            .width(24)

          // å†…å®¹
          Column({ space: 2 }) {
            Text('æ¸…ç©ºæ‰€æœ‰æ•°æ®')
              .fontSize(16)
              .fontColor('#333')
              .fontWeight(FontWeight.Medium)
            Text('æ°¸ä¹…åˆ é™¤æ‰€æœ‰ç‰©å“è®°å½•')
              .fontSize(12)
              .fontColor('#999')
          }
          .layoutWeight(1)

          // å³ä¾§ç®­å¤´
          Text('â€º')
            .fontSize(20)
            .fontColor('#999')
        }
        .width('100%')
        .height(56)
        .alignItems(VerticalAlign.Center)
        .onClick(() => {
          this.safeHandleClearData();
        })
      }
      .width('100%')
      .backgroundColor(Color.White)
      .borderRadius(12)
      .padding(12)
      .shadow({ radius: 4, color: '#0D000000', offsetY: 2 })
    }
    .width('100%')
    .margin({ bottom: 16 })
  }

  // å…³äºä¸å¸®åŠ©å¡ç‰‡
  @Builder
  private buildAboutCard() {
    Column() {
      Text('å…³äºä¸å¸®åŠ©')
        .fontSize(14)
        .fontColor('#666')
        .margin({ bottom: 8 })
        .width('100%')

      Column() {
        // åº”ç”¨ä¿¡æ¯
        Row() {
          Text('ğŸ“±')
            .fontSize(20)
            .margin({ right: 12 })
            .width(24)

          Column({ space: 2 }) {
            Text(this.appInfo.name)
              .fontSize(16)
              .fontColor('#333')
              .fontWeight(FontWeight.Medium)
            Text('ç‰ˆæœ¬ ' + this.appInfo.version)
              .fontSize(12)
              .fontColor('#999')
          }
          .layoutWeight(1)
        }
        .width('100%')
        .height(56)
        .alignItems(VerticalAlign.Center)

        Divider()
          .color('#F0F0F0')
          .margin({ left: 36, right: 0 })

        // å¸®åŠ©
        Row() {
          Text('ğŸ¯')
            .fontSize(20)
            .margin({ right: 12 })
            .width(24)

          Column({ space: 2 }) {
            Text('å¸®åŠ©')
              .fontSize(16)
              .fontColor('#333')
              .fontWeight(FontWeight.Medium)
            Text('ä½¿ç”¨æ•™ç¨‹ä¸æ“ä½œæŒ‡å—')
              .fontSize(12)
              .fontColor('#999')
          }
          .layoutWeight(1)

          Text('â€º')
            .fontSize(20)
            .fontColor('#999')
        }
        .width('100%')
        .height(56)
        .alignItems(VerticalAlign.Center)
        .onClick(() => {
          this.showHelpDialog = true;
        })

        Divider()
          .color('#F0F0F0')
          .margin({ left: 36, right: 0 })

        // å¼€å‘è€…ä¿¡æ¯
        Row() {
          Text('ğŸ‘¨â€ğŸ’»')
            .fontSize(20)
            .margin({ right: 12 })
            .width(24)

          Column({ space: 2 }) {
            Text('å¼€å‘è€…ä¿¡æ¯')
              .fontSize(16)
              .fontColor('#333')
              .fontWeight(FontWeight.Medium)
            Text(this.appInfo.developer)
              .fontSize(12)
              .fontColor('#999')
          }
          .layoutWeight(1)
        }
        .width('100%')
        .height(56)
        .alignItems(VerticalAlign.Center)
      }
      .width('100%')
      .backgroundColor(Color.White)
      .borderRadius(12)
      .padding(12)
      .shadow({ radius: 4, color: '#0D000000', offsetY: 2 })
    }
    .width('100%')
    .margin({ bottom: 16 })
  }

  // åº•éƒ¨ä¿¡æ¯
  @Builder
  private buildFooter() {
    Column() {
      Text(this.appInfo.copyright)
        .fontSize(12)
        .fontColor('#999')
      Text('åŸºäº OpenHarmony å¼€å‘')
        .fontSize(12)
        .fontColor('#999')
        .margin({ top: 4 })
    }
    .width('100%')
    .padding({ top: 24, bottom: 32 })
    .alignItems(HorizontalAlign.Center)
  }

  // ========== å¯¹è¯æ¡†æ„å»ºæ–¹æ³• ==========
  // æ¸…ç©ºæ•°æ®ç¡®è®¤å¯¹è¯æ¡†
  @Builder
  private buildConfirmDialog() {
    Column() {
      Column() {
        // æ ‡é¢˜
        Text('ç¡®è®¤æ¸…ç©ºæ•°æ®')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333')
          .margin({ bottom: 12 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // è­¦å‘Šå›¾æ ‡
        Text('âš ï¸')
          .fontSize(48)
          .margin({ bottom: 16 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // æ•°æ®ç»Ÿè®¡
        Text(`å½“å‰å…±æœ‰ ${this.itemCount} ä¸ªç‰©å“è®°å½•`)
          .fontSize(14)
          .fontColor('#666')
          .margin({ bottom: 16 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // è­¦å‘Šè¯´æ˜
        Text('æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ‰€æœ‰ç‰©å“æ•°æ®ï¼Œä¸”æ— æ³•æ¢å¤ï¼')
          .fontSize(14)
          .fontColor('#F53F3F')
          .margin({ bottom: 24 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // æŒ‰é’®åŒºåŸŸ
        Row() {
          // å–æ¶ˆæŒ‰é’®
          Button('å–æ¶ˆ')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#F0F2F5')
            .fontColor('#666')
            .fontSize(14)
            .borderRadius(8)
            .onClick(() => {
              console.info('å–æ¶ˆæ¸…ç©ºæ•°æ®');
              this.showConfirmDialog = false;
            })

          // ç¡®è®¤æ¸…ç©ºæŒ‰é’®
          Button('ç¡®è®¤æ¸…ç©º')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#F53F3F')
            .fontColor(Color.White)
            .fontSize(14)
            .borderRadius(8)
            .margin({ left: 12 })
            .onClick(() => {
              this.safeExecuteClearData();
            })
        }
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .margin({ left: 24, right: 24 })
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(100)
  }

  // æ— æ•°æ®æç¤ºå¯¹è¯æ¡†
  @Builder
  private buildNoDataDialog() {
    Column() {
      Column() {
        // ä¿¡æ¯å›¾æ ‡
        Text('ğŸ“­')
          .fontSize(48)
          .margin({ bottom: 16 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // æ ‡é¢˜
        Text('æš‚æ— æ•°æ®')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333')
          .margin({ bottom: 8 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // æç¤ºä¿¡æ¯
        Text('å½“å‰æ²¡æœ‰ç‰©å“è®°å½•ï¼Œæ— éœ€æ¸…ç©º')
          .fontSize(14)
          .fontColor('#666')
          .margin({ bottom: 24 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // ç¡®å®šæŒ‰é’®
        Button('çŸ¥é“äº†')
          .width('100%')
          .height(44)
          .backgroundColor('#4A6CF7')
          .fontColor(Color.White)
          .fontSize(14)
          .borderRadius(8)
          .onClick(() => {
            this.showNoDataDialog = false;
          })
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .margin({ left: 24, right: 24 })
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(101)
  }

  // æ¸…ç©ºæˆåŠŸå¯¹è¯æ¡†
  @Builder
  private buildSuccessDialog() {
    Column() {
      Column() {
        // æˆåŠŸå›¾æ ‡
        Text('âœ…')
          .fontSize(48)
          .margin({ bottom: 16 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // æ ‡é¢˜
        Text('æ•°æ®å·²æ¸…ç©º')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333')
          .margin({ bottom: 8 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // æç¤ºä¿¡æ¯
        Text('æ‰€æœ‰ç‰©å“æ•°æ®å·²è¢«å®‰å…¨æ¸…é™¤')
          .fontSize(14)
          .fontColor('#666')
          .margin({ bottom: 24 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // ç¡®å®šæŒ‰é’®
        Button('çŸ¥é“äº†')
          .width('100%')
          .height(44)
          .backgroundColor('#4A6CF7')
          .fontColor(Color.White)
          .fontSize(14)
          .borderRadius(8)
          .onClick(() => {
            this.showSuccessDialog = false;
          })
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .margin({ left: 24, right: 24 })
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(102)
  }

  // ç¼–è¾‘èµ„æ–™å¯¹è¯æ¡†
  @Builder
  private buildEditDialog() {
    Column() {
      Column() {
        // æ ‡é¢˜
        Text('ç¼–è¾‘èµ„æ–™')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333')
          .margin({ bottom: 20 })
          .width('100%')
          .textAlign(TextAlign.Center)

        // å¤´åƒ
        Row() {
          Column() {
            Text('ğŸ‘¤')
              .fontSize(32)
              .fontColor('#4A6CF7')
          }
          .width(64)
          .height(64)
          .backgroundColor('#F0F5FF')
          .borderRadius(32)
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
        }
        .width('100%')
        .margin({ bottom: 20 })
        .justifyContent(FlexAlign.Center)

        // æ˜µç§°ç¼–è¾‘
        Column() {
          Text('æ˜µç§°')
            .fontSize(14)
            .fontColor('#666')
            .margin({ bottom: 8 })
            .width('100%')
            .textAlign(TextAlign.Start)

          TextInput({ text: this.nicknameInput, placeholder: 'è¯·è¾“å…¥æ˜µç§°' })
            .width('100%')
            .height(44)
            .backgroundColor('#F8F9FA')
            .fontSize(15)
            .fontColor('#333')
            .placeholderColor('#999')
            .placeholderFont({ size: 15, weight: FontWeight.Normal })
            .maxLength(12)
            .borderRadius(8)
            .padding({ left: 12, right: 12 })
            .onChange((value: string) => {
              this.nicknameInput = value;
            })
        }
        .width('100%')
        .margin({ bottom: 24 })

        // æŒ‰é’®åŒºåŸŸ
        Row() {
          // å–æ¶ˆæŒ‰é’®
          Button('å–æ¶ˆ')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#F0F2F5')
            .fontColor('#666')
            .fontSize(14)
            .borderRadius(8)
            .onClick(() => {
              this.showEditDialog = false;
            })

          // ä¿å­˜æŒ‰é’®
          Button('ä¿å­˜')
            .layoutWeight(1)
            .height(44)
            .backgroundColor('#4A6CF7')
            .fontColor(Color.White)
            .fontSize(14)
            .borderRadius(8)
            .margin({ left: 12 })
            .onClick(() => {
              this.saveNickname();
            })
        }
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .margin({ left: 24, right: 24 })
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(103)
  }



  // å¸®åŠ©å¯¹è¯æ¡†
  @Builder
  private buildHelpDialog() {
    Column() {
      Column() {
        // æ ‡é¢˜æ 
        Row() {
          Text('ğŸ¯')
            .fontSize(24)
            .margin({ right: 8 })
          Text('ä½¿ç”¨å¸®åŠ©')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#333')
        }
        .width('100%')
        .margin({ bottom: 20 })
        .justifyContent(FlexAlign.Start)

        // å†…å®¹åŒºåŸŸ
        Scroll() {
          Column({ space: 16 }) {
            Column() {
              Text('æ¬¢è¿ä½¿ç”¨è½»ç‰©å¿—ï¼ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ã€‚')
                .fontSize(13)
                .fontColor('#666')
                .lineHeight(18)
            }
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)
            .width('100%')

            // æ­¥éª¤1
            Row({ space: 12 }) {
              Column() {
                Text('1')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#4A6CF7')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('æ·»åŠ ç‰©å“')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('ç‚¹å‡»åº•éƒ¨"æ·»åŠ "æ ‡ç­¾ â†’ å¡«å†™ç‰©å“ä¿¡æ¯ â†’ é€‰æ‹©åˆ†ç±» â†’ ç‚¹å‡»"æ·»åŠ ç‰©å“"æŒ‰é’®å®Œæˆ')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            // æ­¥éª¤2
            Row({ space: 12 }) {
              Column() {
                Text('2')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#34C759')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('æŸ¥çœ‹ä¸æœç´¢')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('ç‚¹å‡»"ç‰©å“åˆ—è¡¨"æŸ¥çœ‹æ‰€æœ‰ç‰©å“ â†’ ä½¿ç”¨é¡¶éƒ¨æœç´¢æ¡†å¿«é€ŸæŸ¥æ‰¾ â†’ æ”¯æŒæŒ‰åç§°ã€åˆ†ç±»ã€ä½ç½®æœç´¢')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            // æ­¥éª¤3
            Row({ space: 12 }) {
              Column() {
                Text('3')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#FF9500')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('ç¼–è¾‘ä¸åˆ é™¤')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('åœ¨ç‰©å“åˆ—è¡¨å‘å·¦æ»‘åŠ¨ â†’ ç‚¹å‡»"ç¼–è¾‘"ä¿®æ”¹ä¿¡æ¯ â†’ ç‚¹å‡»"åˆ é™¤"ç§»é™¤è®°å½•')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            // æ­¥éª¤4
            Row({ space: 12 }) {
              Column() {
                Text('4')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#5856D6')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('æŸ¥çœ‹ç»Ÿè®¡')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('ç‚¹å‡»"ç»Ÿè®¡"æ ‡ç­¾ â†’ æŸ¥çœ‹ç‰©å“åˆ†ç±»åˆ†å¸ƒ â†’ åˆ†æä½¿ç”¨çŠ¶æ€ç»Ÿè®¡ â†’ å›¾è¡¨å¯è§†åŒ–å±•ç¤º')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            // æ­¥éª¤5
            Row({ space: 12 }) {
              Column() {
                Text('5')
                  .fontSize(14)
                  .fontWeight(FontWeight.Bold)
                  .fontColor(Color.White)
              }
              .width(24)
              .height(24)
              .backgroundColor('#FF2D55')
              .borderRadius(12)
              .justifyContent(FlexAlign.Center)
              .alignItems(HorizontalAlign.Center)
              .flexShrink(0)

              Column({ space: 4 }) {
                Text('ç®¡ç†æ•°æ®')
                  .fontSize(15)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
                Text('è¿›å…¥"æˆ‘çš„"é¡µé¢ â†’ ç‚¹å‡»"æ¸…ç©ºæ‰€æœ‰æ•°æ®" â†’ ç¡®è®¤åå®‰å…¨åˆ é™¤æ‰€æœ‰è®°å½•')
                  .fontSize(12)
                  .fontColor('#666')
                  .lineHeight(16)
              }
              .layoutWeight(1)
            }
            .width('100%')
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)

            // ä½¿ç”¨å»ºè®®
            Column() {
              Row() {
                Text('ğŸ’¡')
                  .fontSize(16)
                  .margin({ right: 8 })
                Text('ä½¿ç”¨å»ºè®®')
                  .fontSize(14)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#333')
              }
              .width('100%')
              .margin({ bottom: 8 })

              Text('â€¢ ä¸ºç‰©å“é€‰æ‹©åˆé€‚çš„åˆ†ç±»ï¼Œæ–¹ä¾¿åç»­æŸ¥æ‰¾å’Œç®¡ç†\nâ€¢ è¯¦ç»†è®°å½•ç‰©å“ä½ç½®ï¼Œéœ€è¦æ—¶èƒ½å¿«é€Ÿæ‰¾åˆ°\nâ€¢ å®šæœŸä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½äº†è§£ç‰©å“åˆ†å¸ƒæƒ…å†µ\nâ€¢ é‡è¦ç‰©å“å¯æ·»åŠ è¯¦ç»†å¤‡æ³¨ä¿¡æ¯')
                .fontSize(12)
                .fontColor('#666')
                .lineHeight(18)
            }
            .padding(12)
            .backgroundColor('#F9FAFB')
            .borderRadius(10)
            .width('100%')
          }
          .padding({ right: 4 })
        }
        .layoutWeight(1)
        .margin({ bottom: 20 })
        .scrollBar(BarState.Auto)

        // å¼€å§‹ä½¿ç”¨æŒ‰é’®
        Button('å¼€å§‹ä½¿ç”¨')
          .width('100%')
          .height(44)
          .backgroundColor('#4A6CF7')
          .fontColor(Color.White)
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .borderRadius(8)
          .onClick(() => {
            this.showHelpDialog = false;
          })
      }
      .padding(24)
      .backgroundColor(Color.White)
      .borderRadius(20)
      .width('90%')
      .height('75%')
      .shadow({ radius: 32, color: '#40000000' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(201)
  }

  // åŠ è½½ä¸­é®ç½©
  @Builder
  private buildLoadingOverlay() {
    Column() {
      LoadingProgress()
        .color(Color.White)
        .width(48)
        .height(48)

      Text('æ­£åœ¨æ¸…ç©ºæ•°æ®...')
        .fontSize(16)
        .fontColor(Color.White)
        .margin({ top: 16 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#80000000')
    .justifyContent(FlexAlign.Center)
    .position({ x: 0, y: 0 })
    .zIndex(300)
  }

  // ========== ä¸»æ„å»ºæ–¹æ³• ==========
  build() {
    Column() {
      // æ»šåŠ¨å†…å®¹åŒºåŸŸ
      Scroll() {
        Column() {
          // ç”¨æˆ·ä¿¡æ¯å¡ç‰‡
          this.buildUserInfoCard()
          // æ•°æ®ç®¡ç†å¡ç‰‡
          this.buildDataManagementCard()
          // å…³äºä¸å¸®åŠ©å¡ç‰‡
          this.buildAboutCard()
          // åº•éƒ¨ç‰ˆæƒä¿¡æ¯
          this.buildFooter()
        }
        .padding({ left: 16, right: 16, bottom: 32 })
      }
      .scrollBar(BarState.Off)
      .layoutWeight(1)

      // 3. æ¸…ç©ºæ•°æ®ç¡®è®¤å¯¹è¯æ¡†
      if (this.showConfirmDialog) {
        this.buildConfirmDialog()
      }

      // 4. æ— æ•°æ®æç¤ºå¯¹è¯æ¡†
      if (this.showNoDataDialog) {
        this.buildNoDataDialog()
      }

      // 5. æ¸…ç©ºæˆåŠŸå¯¹è¯æ¡†
      if (this.showSuccessDialog) {
        this.buildSuccessDialog()
      }

      // 6. ç¼–è¾‘èµ„æ–™å¯¹è¯æ¡†
      if (this.showEditDialog) {
        this.buildEditDialog()
      }

      // 7. å¸®åŠ©å¯¹è¯æ¡†
      if (this.showHelpDialog) {
        this.buildHelpDialog()
      }

      // 8. åŠ è½½ä¸­é®ç½©
      if (this.isClearing) {
        this.buildLoadingOverlay()
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F9FAFB')
  }
}